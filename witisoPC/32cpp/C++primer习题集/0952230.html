<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>0952230</title><script type="text/javascript">
var userAgent = navigator.userAgent.toLowerCase();
var browser = 
    (browser = userAgent.match(/qqbrowser\/([\d.]+)/))?"qqbrowser/"+browser[1]:
    (browser = userAgent.match(/se\s+2.x/))?"sogou/2.x": //sougou
    (browser = userAgent.match(/msie\s+([\d.]+)/))?"msie/"+browser[1]: //ie
    (browser = userAgent.match(/chrome\/([\d.]+)/))?"chrome/"+browser[1]: //chrome
    (browser = userAgent.match(/firefox\/([\d.]+)/))?"firefox/"+browser[1]: //firefox
    (browser = userAgent.match(/version\/([\d.]+)\s+safari\/([\d.]+)/))?"safari/"+browser[1]: //safari
    (browser = userAgent.match(/opera\/([\d.]+)([\w\W]+)version\/([\d.]+)/))?"opera/"+browser[3]: //opera
    "other browser";
    var browser4 = browser.substr(0,2);
//实现回到页面顶部  
function goTopEx(){  
    var obj=document.getElementById("goTopBtn"); 
    var obj2=document.getElementById("shangy"); 
    var obj3=document.getElementById("xiay");
    var obj4=document.getElementById("goBottom");  
    
    function getScrollTop(){  
        if(browser4=="ch"){
            //chrome
            //chrome63.0.3239.132对DTD XHTML 1.0不再支持body.scrollTop属性，只支持documentElement.scrollTop 
            return document.documentElement.scrollTop; 
        }else{
            //IE、firefox
            return document.documentElement.scrollTop;  
        }  
    }
    function setScrollTop(value){ 
        if(browser4=="ch"){ 
            //chrome
            document.documentElement.scrollTop=value; 
        }else{  
            //IE、firefox
            document.documentElement.scrollTop=value;  
        } 
    }     
    window.onscroll=function(){getScrollTop()>50?obj.style.display="":obj.style.display="none";
    getScrollTop()>100?obj2.style.display="":obj2.style.display="none";
    document.body.clientHeight-getScrollTop()>650?obj3.style.display="":obj3.style.display="none";
    document.body.clientHeight-getScrollTop()>650?obj4.style.display="":obj4.style.display="none";
    }  
    obj.onclick=function(){  
        var goTop=setInterval(scrollMove,10);  
        function scrollMove(){  
                setScrollTop(getScrollTop()/1.1);  
                if(getScrollTop()<1)clearInterval(goTop);  
        }  
    }  
}  
function downn(){
    if(browser4=="ch"){
        //chrome
        window.scrollBy(0,document.body.clientHeight);
    }else{
        //IE、firefox
        window.scrollBy(0,document.documentElement.clientHeight*1000); 
    }
}
</script>
<script>
function changePage(){ 
    var page = document.getElementById("container");
    page.style.background="black";
    page.style.color="white";
    page.style.fontSize="22px";
    page.style.fontFamily="MV boli";
}
document.write('<div style="position:fixed; right: 10px; top:20px; color:#eee;">背景颜色<br><select name=bcolor id=bcolor onchange="javascript:document.body.style.background=this.options[this.selectedIndex].value;"><option style="background-color: #ffffff" value="#ffffff">白色</option><option style="background-color: #f6f6f6" value="#f6f6f6">银灰</option><option style="background-color: #e4ebf1" value="#e4ebf1">淡蓝</option><option style="background-color: #e6f3ff" value="#e6f3ff">蓝色</option> <option style="background-color: #eeeeee" value="#eeeeee">淡灰</option><option style="background-color: #eaeaea" value="#eaeaea">灰色</option>  <option style="background-color: #e4e1d8" value="#e4e1d8">深灰</option><option style="background-color: #e6e6e6" value="#e6e6e6">暗灰</option><option style="background-color: #eefaee" value="#eefaee">绿色</option><option style="background-color: #ffffed" value="#ffffed">明黄</option><option style="background-color: #333333" value="#333333">黑色</option></select><br>字体颜色<br><select name=txtcolor id=txtcolor onchange="javascript:document.getElementById(\'container\').style.color=this.options[this.selectedIndex].value;"> <option value="#000000">黑色</option><option value="#ff0000" style="color:red;">红色</option><option value="#006600" style="color:green;">绿色</option><option value="#0000ff" style="color:blue;">蓝色</option><option value="#660000" style="color:#006600;">棕色</option><option value="#ffffff">白色</option></select><br>字体大小<br><select name=fontsize id=fonttype onchange="javascript:document.getElementById(\'container\').style.fontSize=this.options[this.selectedIndex].value;"> <option value="12px" >小号</option> <option value="14px" >较小</option> <option value="19px" >中号</option> <option value="19px" >默认</option><option value="22px" >较大</option><option value="25px" >大号</option><option value="35px" >35px</option><option value="45px" >45px</option><option value="55px" >55px</option><option value="65px" >65px</option><option value="75px" >75px</option><option value="85px" >85px</option><option value="95px" >95px</option></select>><br>字体类型<br><select name=fonttype id=fonttype onchange="javascript:document.getElementById(\'container\').style.fontFamily=this.options[this.selectedIndex].value;"> <option value="宋体" >宋体</option> <option value="MV boli" style="font-family:MV boli">MV boli</option> <option value="隶书" style="font-family:隶书">隶书</option> <option value="黑体" style="font-family:黑体">黑体</option><option value="楷体" style="font-family:楷体">楷体</option><option value="幼圆" style="font-family:幼圆">幼圆</option><option value="华文中宋" style="font-family:华文中宋">华文中宋</option><option value="华文行楷" style="font-family:华文行楷">华文行楷</option><option value="微软雅黑" style="font-family:微软雅黑">微软雅黑</option><option value="Arial" style="font-family:Arial">Arial</option><option value="Vrinda" style="font-family:Vrinda">Vrinda</option><option value="Tahoma" style="font-family:Tahoma">Tahoma</option><option value="Courier" style="font-family:Courier">Courier</option><option value="Times" style="font-family:Times">Times</option><option value="Georgia" style="font-family:Georgia">Georgia</option><option value="Lucida" style="font-family:Lucida">Lucida</option></select><br><a onClick="changePage()" target="_self" id="changepage">黑底白字</a></div>');   
</script>
<style type="text/css">
#tbrowser a:linked container a:visited{
    font-size:18px;
    text-decoration:none;
}
a:link{
    text-decoration:none;
    }
#container{
    font-size:1.2em;
    margin:auto;
    font-family:"宋体";
    width:65.29%;
    line-height:1.6em;
}
P{
    margin-top:16px;
    margin-bottom:16px;
    text-indent:2em;
}
.uls{
    color:#CC6666;
    font-weight:bold;
}
.uls>ol{
    list-style:none;
    font-weight:normal;
    list-style:lower-latin;
    color:#000000;
    line-height:1.3em;
}
h3{
    font-size:1.1em;
    font-weight:bold;
    text-indent:0em;
    color:#990000;
}
h4{
    font-size:1.0em;
    font-weight:bold;
    text-indent:0em;
}

#goTopBtn, #goBottom, #shangy, #xiay, #ftsize1, #ftsize2, #ftsize3{
    width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    font-size: 12px;
    text-align: center;
    position: fixed;
    right: 10px;
    cursor: pointer;
    filter: Alpha(opacity=30);
    opacity=.3;
    font-weight:bold;
}
#goTopBtn, #goBottom, #ftsize1, #ftsize3  {
    background-color:#999;
    color:#000;
}
#shangy, #xiay, #ftsize2{
    background-color: #bbb;
    color: #000;
}
#ftsize1{
    bottom:240px;
}
#ftsize2{
    bottom:214px;
}
#ftsize3{
    bottom:188px;
}

#goTopBtn{
    bottom: 105px;
}
#goBottom {
    bottom: 30px;
}
#shangy {
    bottom: 80px;
}
#xiay {
    bottom: 55px;
}
#goTopBtn:hover, #goBottom:hover, #shangy:hover, #xiay:hover, #ftsize1:hover, #ftsize2:hover, #ftsize3:hover{
    background-color:#ccc;
    border:#ccc 0px solid;
}
#goTopBtn a:link, #goBottom a:link, #xiay a:link, #shangy a:link, #ftsize1 a:link, #ftsize2 a:link, #ftsize3 a:link {
    text-decoration: none;
    color:white;
}
img{
    margin-right:2em;
    text-indent:2em;
    border:0;
}
.picsay{
    color:#930;
    font-size:90%;
    line-height:110%;
    margin-top:-12px;
    padding:0;
}
.remark{
    color:#930;
    font-size:90%;
    line-height:140%;
    margin-top:-12px;
    text-indent:0em;
    padding:0;
}
.ref{
    color:#930;
    font-size:95%;
    line-height:150%;
    margin-top:-12px;
    text-indent:2em;
    padding:0;
}
pre{
    width:100%;
    font-size:120%;
    line-height:130%;
    padding:0;
    //background-color:#f6f6f6;
    //background-color:#fff5ee;
    //background-color:#ffe;
    background-color:#eee;
    padding:8px;
    margin-left:2em;
    color:blue;
    overflow-x:auto;
    }
.code0, .code2, .code4{
    font-size:95%;
    line-height:110%;
    margin-top:-12px;
    padding:0;
    //background-color:#D9D1CA;
    //background-color:#f6f6f6;
    //background-color:#fff5ee;
    background-color:#ffe;
}
.code0{
    color:red;
    text-indent:0em;
}
.code2{
    color:#930;
    text-indent:2em;
}
.code4{
    color:blue;
    text-indent:4em;
}
sub,sup{
    font-size:80%;
    color:red;
}
</style>
</head>

<body>

<div id="container">





<h4>0952230</h4>


<p>练习9.52：使用stack处理括号化的表达式。当你看到一个左括号，将其记录下来。当你在一个左括号之后看到一个右括号，从stack中pop对象，直至遇到左括号，将左括号也一起弹出栈。然后将一个值（括号内的运算结果）push到栈中，表示一个括号化的（子）表达式已经处理完毕，被其运算结果所替代。</p>
<p>【出题思路】</p>
<p>本题作为栈数据结构的基本练习有些复杂。原因在于，表达式的解析算法对于编程初学者来说相对复杂。解答本题更多的工作是设计表达式解析的逻辑，栈的操作变为次要地位。</p>
<p>【解答】</p>
<p>如下所示，本题的解答已经较为复杂，但这已是将问题大幅简化之后的解答了。我们假定表达式中只有加、减两种运算，由于所有运算优先级相同，无须进行复杂的优先级判断。由于加、减运算都是左结合，因此，遇到一个数值，直接与之前的运算数进行它们中间的运算即可。唯一的例外是括号，它将改变计算次序--括号里的运算将先于括号前的运算执行。不过，我们可以将它看作“阻断” 了括号前的表达式，将括号内的部分看作一个独立的表达式优先处理，计算结果作为一个运算数参与之前的运算即可。</p>
<p>表达式解析的逻辑大致如下：</p>
<p>1. 读入了 一个运算数V。</p>
<p>a） 若栈空或栈顶是左括号，则v是第一个运算数，直接压栈即可。</p>
<p>b） 否则，v前必须是一个运算符，再之前是另一个运算数v'，从栈顶弹出这两项，将计算结果压栈即可；否则，就抛出一个“缺少运算符”异常。</p>
<p>2. 读入了一个左括号，直接压栈。</p>
<p>3. 读入了一个运算符，</p>
<p>a）  若栈空或栈顶不是一个运算数，则抛出一个“缺少运算数”异常。注意，若运算符之前是一个右括号，之前也已处理完毕，栈顶是其计算结果，仍应该是运算数，不影响此逻辑。</p>
<p>b） 否则，运算符压栈。</p>
<p>4. 读入了一个右括号，</p>
<p>a） 若栈空，表明之前没有与之配对的左括号，抛出“未匹配右括号”异常。</p>
<p>b） 若栈顶是左括号，表明括号对之间无表达式，抛出“空括号”异常。</p>
<p>c） 若栈顶不是运算数，表明括号内缺少一个运算数，抛出一个异常。</p>
<p><p>d） 弹出此运算数V,若栈空或栈顶不是左括号，仍抛出“未匹配右括号”异常；</p>
<p>否则弹出左括号，把v作为新运算数，执行1中的逻辑。</p></p>
<p>5. 以上均不是，则出现了非法输入，会在转换为数值时产生异常。</p>
<p>6.  当字符串处理完毕后，判断栈中是否有且仅有一个运算数，若是，此值即为表达式运算结果，输出它；否则，表达式非法。</p>
<p>值得注意的是，为了在栈中保存括号、运算符和运算数三类对象，程序中定义了枚举类型obj_type。栈中每个对象都保存了类型t和数值v （如果t是VAL的话）。</p>
<p></p>
<pre style="line-height:130%; background-color:#F6F6F6; font-size:120%; padding:8px; margin-left:2em; color:black; ">
<font color=#C00>#include</font>&lt;iostream>
<font color=#C00>#include</font>&lt;string>
<font color=#C00>#include</font>&lt;deque>
<font color=#C00>#include</font>&lt;stack>
<font color=#C00>#include</font>&lt;stdexcept>
<font color=#00F>using</font> <font color=#00F>namespace </font>std;
<font color=#CCC>//表示栈中对象的不同类型</font>
<font color=#00F>enum</font> obj_type {LP, RP, ADD, SUB, VAL};
<font color=#00F>struct</font> obj {
    obj(obj_type type, <font color=#00F>double </font>val = 0) { 
        t = type;
        v = val;}
    obj_type t;
    <font color=#00F>double </font>v;
};
<font color=#00F>inline</font> <font color=#00F>void </font>skipws(string &exp, size_t &p)
{
    p = exp.find_first_not_of(" ",p);
}
<font color=#00F>inline</font> <font color=#00F>void </font>new_val(stack&lt;obj> &so, <font color=#00F>double </font>v)
{
   <font color=#00F> if</font>(so.empty() || so.top().t == LP) { <font color=#CCC>// 空栈或左括号</font>
        so.push(obj(VAL, v));
        <font color=#CCC>// cout &lt;&lt; "push"" &lt;&lt; v &lt;&lt; endl;</font>
    } <font color=#00F>else </font>if(so.top().t == ADD || so.top().t == SUB) {
        <font color=#CCC>//之前是运算符</font>
        obj_type type = so.top().t;
        so.pop();
        <font color=#CCC>/*if(type == ADD)
        cout &lt;&lt; "pop +" &lt;&lt; endl;
        else cout &lt;&lt; "pop-" &lt;&lt; endl;*/</font>
        <font color=#CCC>// cout &lt;&lt; "pop" &lt;&lt; so.top().v &lt;&lt; endl;</font>
        <font color=#CCC>//执行加减法</font>
        <font color=#00F>if </font>(type == ADD)
            v += so.top().v;
        <font color=#00F>else </font>v = so.top().v - v;
        so.pop();
        so.push(obj(VAL, v));             <font color=#CCC>// 运算结果压栈</font>
        <font color=#CCC>// cout &lt;&lt; "push " &lt;&lt; v &lt;&lt; endl;</font>
    } <font color=#00F>else </font>throw invalid_argument ("缺少运算符");
}
<font color=#00F>int</font><font color=#00F> main</font>()
{
    stack&lt;obj> so;
    string exp;
    size_t p = 0, q;
    double v;
    
    cout &lt;&lt; "请输入表达式：";
        getline(cin, exp);
    
    while(p &lt; exp.size ()) {
        skipws (exp, p) ;                   <font color=#CCC>// 跳过空格</font>
        if(exp[p] == '(') {              <font color=#CCC>//左括号直接压栈</font>
            so.push(obj(LP));
            p++;
                <font color=#CCC>// cout &lt;&lt; "push LP" &lt;&lt; endl;</font>
        } <font color=#00F>else </font>if(exp[p] == '+' || exp[p] == '-') {
            <font color=#CCC>//新运算符</font>
            if(so.empty() || so.top().t != VAL)
                <font color=#CCC>//空栈或之前不是运算数</font>
                <font color=#00F>throw </font>invalid_argument("缺少运算数");
            
            if(exp[p] == '+')             <font color=#CCC>// 运算符压栈</font>
                so.push(obj(ADD));
            else so.push (obj(SUB));
            p++;
            <font color=#CCC>// cout &lt;&lt; "push" &lt;&lt; exp[p - 1] &lt;&lt; endl;</font>
            } <font color=#00F>else </font>if(exp[p] ==')'){         <font color=#CCC>// 右括号</font>
                p++;
                   <font color=#00F> if</font>(so.empty() )              <font color=#CCC>//之前无配对的左括号</font>
                        <font color=#00F>throw </font>invalid_argument ("未匹配右括号");
                    
                   <font color=#00F> if</font>(so.top().t == LP)         <font color=#CCC>// 一对括号之间无内容</font>
                        <font color=#00F>throw </font>invalid_argument ("空括号");
                    
                   <font color=#00F> if</font>(so.top().t == VAL) {  <font color=#CCC>//正确：括号内运算结果</font>
                        v = so.top().v;
                        so.pop();
                            <font color=#CCC>// cout &lt;&lt; "pop LP" &lt;&lt; v &lt;&lt; endl;</font>
                            
                            if(so.empty() || so.top().t != LP)
                                throw invalid_argument ("未匹配右括号");
                            
                            so.pop();
                            <font color=#CCC>// cout &lt;&lt; "pop LP" &lt;&lt; endl;</font>
                            new_val (so, v) ;         <font color=#CCC>//与新运算数逻辑一致</font>
                    } <font color=#00F>else </font>                     <font color=#CCC>//栈顶必定是运算符</font>
                        <font color=#00F>throw </font>invalid_argument("缺少运算数");
            } <font color=#00F>else </font>{                     <font color=#CCC>//应该是运算数</font>
                v = stod(exp.substr(p), &q);
                    p += q;
                    new_val(so, v);
            }
    }
                
    if(so.size() != 1 || so.top().t != VAL)
        throw invalid_argument("非法表达式");
                
    cout &lt;&lt; so.top().v &lt;&lt;<font color=#C00> endl</font>;
                
    return 0;
}
</pre>
<p>【解答解题思路】</p>
<p>其实，如果不是强制使用栈来手工处理解析过程的数据，我们可以写出一个递                            归算法（其实是编译器隐含使用栈为我们保存了相关数据）来解析表达式，会更为                            简洁、清晰。</p>


<p style='float:right;'>本页共132段，5847个字符，8397 Byte(字节)</p>﻿




</div>


<div>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.4em";' target="_self" style="color:#fff;" title="大：1.4em"><div id="ftsize1" style="color:#fff;">大</div></a>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.2em";' target="_self" style="color:#fff;" title="中：1.2em"><div id="ftsize2" style="color:#fff;">中</div></a>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.0em";' target="_self" style="color:#fff;" title="小：1em"><div id="ftsize3" style="color:#fff;">小</div></a>

<a target="_self" style="color:#fff;"><div style="display:none; color:#fff;" id="goTopBtn">&and;</div></a>
<a onclick="shangy()" target="_self" style="color:#fff;"><div style="display:none; color:#fff;" id="shangy">&uarr;</div></a>
<a onclick="xiay()" target="_self" style="color:#fff;"><div id="xiay" style="color:#fff;">&darr;</div></a>
<a onclick="downn()" target="_self" style="color:#fff;"><div id="goBottom" style="color:#fff;">&or;</div></a>
<script type=text/javascript>
    goTopEx();
    function xiay(){
        window.scrollBy(0,window.innerHeight-10);
    }
    function shangy(){
        window.scrollBy(0,-window.innerHeight+10);
    }
    var obj3=document.getElementById("xiay");
    var obj4=document.getElementById("goBottom");
    function getHeight(){  
        if(browser4=="ch"){
            //谷歌浏览器
            return document.body.clientHeight; 
        }else{
            //IE、firefox等浏览器 
            return document.documentElement.clientHeight;  
        }  
    }
    getHeight()<window.innerHeight+50?obj3.style.display="none":obj3.style.display="";
    getHeight()<window.innerHeight+50?obj4.style.display="none":obj4.style.display="";
    if(browser4!="ch"){    //firefox需要尝一下才显示向下图标
        xiay();
        shangy();
    }
</script>
</div>

</body>
</html>
