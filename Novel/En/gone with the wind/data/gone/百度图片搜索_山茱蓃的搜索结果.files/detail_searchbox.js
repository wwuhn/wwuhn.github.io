function f_submit(A,C){A.tn.value="baiduimage";A.ct.value="201326592";A.cl.value="2";A.lm.value="-1";A.pv.value="";A.action="/i";if(C==true){A.se.value="1"}else{var B=parseInt(BD.IMG.ParamsBus.getGlobalConfItem("showtab"));if(!isNaN(B)&&B>0){A.showtab.value=B}}return true}BD.IMG.albumConf={preCacheMaxNum:1,nextCacheMaxNum:1,displayNum:4,displayPosition:2,nexPageKey:39,prePageKey:37,browsePreKey:38,browseNextKey:40};BD.IMG.detaiImg=(function(){var host="i";try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}window.onerror=function(){return true};function trim(str){return str.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")}BD.IMG.trim=trim;function json2Query(json){if(json==null||typeof json!="object"){return json}var query=[];for(var i in json){query[query.length]=i+"="+json[i]}return query.join("&")}BD.IMG.json2Query=json2Query;function query2Json(query){if(query==null||typeof query!="string"){return query}var json={};var queryMap=query.split("&");for(var i=0,len=queryMap.length;i<len;i++){var s=queryMap[i].split("=");json[s[0]]=s[1]}return json}BD.IMG.query2Json=query2Json;var searchConf=query2Json(window.location.search.substring(1));function G(id){return document.getElementById(id)}function customSubStr(str,n,addStr){var r=/[^\x00-\xff]/g;if(str.replace(r,"mm").length<=n){return str}var i,m;for(i=0,m=0;i<str.length,m<n;i++){m+=str.charAt(i).replace(r,"mm").length}if(m>n){i--}return str.substring(0,i)+addStr}BD.IMG.customSubStr=customSubStr;var Browser=(function(){var isIE=(navigator.userAgent.indexOf("MSIE")!=-1)&&!window.opera;var isWebKit=(navigator.userAgent.indexOf("AppleWebKit/")>-1);var isOpera=(typeof window.opera!=="undefined")?true:false;var isGecko=(navigator.userAgent.indexOf("Gecko")>-1)&&(navigator.userAgent.indexOf("KHTML")==-1);return{isIE:isIE,isWebKit:isWebKit,isOpera:isOpera,isGecko:isGecko}})();BD.IMG.Browser=Browser;if(!Browser.isIE){function __attachEvent(type,handler){type=type.replace(/^on/,"");this.addEventListener(type,handler,false)}window.attachEvent=document.attachEvent=HTMLElement.prototype.attachEvent=__attachEvent;function __detachEvent(type,handler){type=type.replace(/^on/,"");this.removeEventListener(type,handler,false)}window.detachEvent=document.detachEvent=HTMLElement.prototype.detachEvent=__detachEvent}function addStyle(a,b){var c=document.styleSheets[0];if(c.addRule){c.addRule(a,b)}else{if(c.insertRule){c.insertRule(a+" { "+b+" }",c.cssRules.length)}}}function getBodySize(){var W=0,H=0,SL=0,ST=0,SW=0,SH=0;var w=window,d=document,dd=d.documentElement;W=dd.clientWidth||d.body.clientWidth;H=w.innerHeight||dd.clientHeight||d.body.clientHeight;ST=d.body.scrollTop||dd.scrollTop;SL=d.body.scrollLeft||dd.scrollLeft;SW=Math.max(d.body.scrollWidth,dd.scrollWidth||0);SH=Math.max(d.body.scrollHeight,dd.scrollHeight||0,H);return{w:W,h:H,sw:SW,sh:SH}}function getW(){var W=0;var d=document,dd=d.documentElement;W=dd.clientWidth||d.body.clientWidth;return W}function getMatrix(){var fwidth=0;if(BD.IMG.getCookie("fb")=="1"){fwidth=120}var w=getW()-fwidth;if(w>=0&&w<580){return[3,3]}else{if(w>=580&&w<810){return[3,4]}else{if(w>=810&&w<1034){return[3,5]}else{if(w>=1034&&w<1286){return[3,6]}else{return[3,7]}}}}}BD.IMG.getMatrix=getMatrix;String.prototype.replaceS=function(){if(arguments.length==0){return this}for(var i=0,len=arguments.length,s=this;i<len;i++){s=s.replace(new RegExp("#\\{"+(i+1)+"\\}#","g"),arguments[i])}return s};if(window.HTMLElement){HTMLElement.prototype.__defineGetter__("children",function(){var tmp=[],j=0,n;for(var i=0;i<this.childNodes.length;i++){n=this.childNodes[i];if(n.nodeType==1){tmp[j++]=n;if(n.name){if(!tmp[n.name]){tmp[n.name]=[]}tmp[n.name][tmp[n.name].length]=n}if(n.id){tmp[n.id]=n}}}return tmp})}function zoom(w,h){if((this.srcWidth>w)||(this.srcHeight>h)){var widthRate=w/this.srcWidth;var heightRate=h/this.srcHeight;if(widthRate<heightRate){this.style.width=w+"px";this.style.height=this.srcHeight*widthRate+"px";this.zoomRate=widthRate}else{this.style.width=this.srcWidth*heightRate+"px";this.style.height=h+"px";this.zoomRate=heightRate}}else{this.zoomRate=1;this.style.width=this.srcWidth+"px";this.style.height=this.srcHeight+"px"}}function zoomImg(w,h,max){var widthRate=max/w;var heightRate=max/h;var height=h,width=w;if(widthRate<heightRate){width=max;height=h*widthRate}else{width=w*heightRate;height=max}return{width:width,height:height}}if(!Browser.isOpera){addStyle("#imgList div img","display:none")}function smallImageZoom(obj,max){max=max||100;obj.style.display="inline";obj.srcWidth=obj.width;obj.srcHeight=obj.height;obj.zoom=zoom;obj.zoom(max,max)}BD.IMG.smallImgZoom=smallImageZoom;function smallImageError(obj){obj.style.display="inline";obj.srcWidth=127;obj.srcHeight=140;obj.zoom=zoom;obj.zoom(80,80)}BD.IMG.smallImgErr=smallImageError;BD.IMG.setCookie=function(name,value){document.cookie=name+"="+escape(value)+"; expires=Thu, 08 Jul 2038 10:05:14 GMT;"};BD.IMG.getCookie=function(name){var sRE="(?:;)?"+name+"=([^;]*);?";var oRE=new RegExp(sRE);if(oRE.test(document.cookie)){return decodeURIComponent(RegExp["$1"])}else{return null}};BD.IMG.cloneObj=(function(buildInObject){return function(source){var result=source,i,len;if(!source||source instanceof Number||source instanceof String||source instanceof Boolean){return result}else{if(source instanceof Array){result=[];var resultLen=0;for(i=0,len=source.length;i<len;i++){result[resultLen++]=BD.IMG.cloneObj(source[i])}}else{if("object"==typeof source){if(buildInObject[Object.prototype.toString.call(source)]){return result}if(source.toString().indexOf("Element")!=-1&&source.nodeType==1){return{}}result={};for(i in source){if(source.hasOwnProperty&&source.hasOwnProperty(i)){result[i]=BD.IMG.cloneObj(source[i])}}}}}return result}})({"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1});window.changeTitle=(function(){var titleStr=window.document.title;return function(){window.document.title=titleStr}})();var net=(function(){function xmlhttpFactory(){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{if(window.ActiveXObject){try{xmlhttp=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}}}return xmlhttp}function getRequest(url,callback,async,args){var xmlhttp=xmlhttpFactory();args=(args||[]);if(async==true){xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState!=4){return }Array.prototype.splice.call(args,0,0,xmlhttp.responseText);callback.apply(window,args)};xmlhttp.open("GET",url,true);xmlhttp.send(null)}else{xmlhttp.open("GET",url,false);xmlhttp.send(null);Array.prototype.splice.call(args,0,0,xmlhttp.responseText);callback.apply(window,args)}}return{getRequest:getRequest}})();var sizeConfig={ecomWidth:217,isEcom:BD.IMG.gconf.isEcom,imgContainerMargin:20,albumWidth:103,albumHeight:582,picInfoHeight:34,imgFromHeight:34,imgSetWidth:107,ecomMargin:BD.IMG.gconf.ecomMargin,containerMargin:BD.IMG.gconf.containerMargin};var sizeHandle=(function(){var imgContainerWidth,detailImgWidth,picwrapHeight,detailImgHeight,picInfoWidth,containerWidth,imgSetWidth,imgFromHeight=34;function ecomWidthHandle(){var size=getBodySize();size.w=size.w-imgSetWidth;if(size.w<980){size.w=980}if(size.w>750){imgContainerWidth=size.w-sizeConfig.ecomWidth-sizeConfig.ecomMargin-sizeConfig.containerMargin;detailImgWidth=imgContainerWidth-sizeConfig.albumWidth}if(523<=size.w&&size.w<=750){imgContainerWidth=750-sizeConfig.ecomWidth-sizeConfig.ecomMargin-sizeConfig.containerMargin;detailImgWidth=imgContainerWidth-sizeConfig.albumWidth}if(size.w<523){imgContainerWidth=size.w-sizeConfig.containerMargin;detailImgWidth=imgContainerWidth-sizeConfig.albumWidth}picInfoWidth=detailImgWidth;if(picInfoWidth>600){picInfoWidth=600}imgContainerWidth=imgContainerWidth+imgSetWidth;containerWidth=imgContainerWidth+sizeConfig.ecomWidth+sizeConfig.ecomMargin}function normalWidthHandle(){var size=getBodySize();size.w=size.w-imgSetWidth;if(size.w<762){size.w=762}imgContainerWidth=size.w-sizeConfig.imgContainerMargin;detailImgWidth=imgContainerWidth-sizeConfig.albumWidth;picInfoWidth=detailImgWidth;imgContainerWidth=imgContainerWidth+imgSetWidth;containerWidth=imgContainerWidth;imgFromWidth=picInfoWidth}function heightHandle(){var size=getBodySize();if(size.h<270){size.h=270}detailImgHeight=size.h-sizeConfig.imgFromHeight;picwrapHeight=detailImgHeight-sizeConfig.picInfoHeight}function get(){if(G("isAlbum")&&G("isAlbum").style.display=="none"){imgSetWidth=0}else{imgSetWidth=sizeConfig.imgSetWidth}if(sizeConfig.isEcom||rpWidth){ecomWidthHandle()}else{normalWidthHandle()}heightHandle();return{imgContainerWidth:imgContainerWidth,detailImgWidth:detailImgWidth,detailImgHeight:detailImgHeight,imgFromHeight:imgFromHeight,picwrapHeight:picwrapHeight,picwrapWidth:detailImgWidth-8,picInfoWidth:picInfoWidth,imgSetWidth:imgSetWidth,containerWidth:containerWidth}}BD.IMG.detailImgSizeInit=function init(){var size=get();addStyle("#container","width:"+size.containerWidth+"px");addStyle("#imgContainer","float:left; margin-right: -"+sizeConfig.ecomWidth+"px;width:"+size.imgContainerWidth+"px;");addStyle("#rightPart","float:right;width:"+sizeConfig.ecomWidth+"px");if(BD.IMG.gconf.isIM&&BD.IMG.gconf.isMA){addStyle("#imContainer","margin-top:15px")}else{if(BD.IMG.gconf.isIM){addStyle("#imContainer","margin-top:21px")}}addStyle("#imgContainer","width:"+size.imgContainerWidth+"px;");addStyle("#detailImg","width:"+size.detailImgWidth+"px");addStyle("#imgFrom","width:"+size.detailImgWidth+"px");addStyle("#picWrap","height:"+size.picwrapHeight+"px;width:"+size.picwrapWidth+"px")};return{get:get}})();var slideClass=function(){var albumObj;var preCallBack;var nextCallBack;var getImgeHtml;var slideConfig;var getCurrentPN;var getListNum;var dic=18;function slideToUp(ImgObj,num){var distance=slideConfig.distance;var currentTop=slideConfig.distance;var firstNode=albumObj.children[0];if(firstNode.children.length>0){firstNode.children[0].style.display="none"}var listNum=getListNum();var slid=setInterval(function(){if(currentTop>dic){currentTop=currentTop-dic;firstNode.style.height=currentTop+"px"}else{firstNode.style.height="0px";clearInterval(slid);albumObj.removeChild(firstNode);firstNode.style.height=slideConfig.distance;var currentPN=getCurrentPN();if(ImgObj&&ImgObj.pageNum==currentPN){firstNode.className="select"}else{if(ImgObj){firstNode.className="noselect"}else{if(num==listNum){firstNode.className="noImgLast"}else{firstNode.className="noImg"}}}firstNode.innerHTML=getImgeHtml(ImgObj);firstNode.style.height=distance+"px";firstNode.id=slideConfig.imgIdStr+num;albumObj.appendChild(firstNode);nextCallBack()}},8)}function slideToDown(ImgObj,num){var distance=slideConfig.distance;var currentTop=0;var albumObjChildren=albumObj.children;var firstNode=albumObjChildren[0];var lastNode=albumObjChildren[albumObjChildren.length-1];var currentPN=getCurrentPN();if(lastNode.children.length>0){lastNode.children[0].style.display="none"}lastNode.style.height="0px";if(ImgObj&&ImgObj.pageNum==currentPN){lastNode.className="select"}else{lastNode.className="noselect"}albumObj.insertBefore(lastNode,firstNode);var slid=setInterval(function(){if(distance-currentTop>dic){lastNode.style.height=currentTop+"px";currentTop=currentTop+dic}else{clearInterval(slid);lastNode.style.height=distance+"px";lastNode.id=slideConfig.imgIdStr+num;lastNode.innerHTML=getImgeHtml(ImgObj);preCallBack()}},8)}return{pre:slideToDown,next:slideToUp,setAlbum:function(obj){albumObj=obj},setPreCallBack:function(callBack){preCallBack=callBack},setNextCallBack:function(callBack){nextCallBack=callBack},setSlideConfig:function(config){slideConfig=config},setCurrentPnFun:function(fun){getCurrentPN=fun},setGetListNumFun:function(fun){getListNum=fun},setImgHtml:function(fun){getImgeHtml=fun}}};var DataManager=(function(){var imgData={};var currPN;var currISPN=-1;var listNum;var currMaxPn;var currMinPn;var IMG_CACHE_PRE=0;var IMG_CACHE_POST=3;var queryParam={};var cacheImgSetPn=-1;function getListNum(){listNum=DataStore.getListNum();return listNum}function getCurrentPN(){return currPN}function getCurrISPN(){return currISPN}function getCurrentImgData(){return DataStore.getImgByPn(currPN,null,null,false)}function getCurrISListNum(){var num=DataStore.getImgSetListNum(currPN);num=(num||0);return num}function getISListNum(pn){var num=DataStore.getImgSetListNum(pn);num=(num||0);return num}function getCurrentImgSetData(){var data;if(currISPN>=0){data=DataStore.getImgSetImg(currPN,currISPN,null,null,false)}else{data=DataStore.getImgByPn(currPN,null,null,false)}return data}function getCurrIS(){var imgobj=DataStore.getImgByPn(currPN,null,null,false);return imgobj.is}function resetCurrentPN(pn,isPn){DataStore.getImgs(Math.max(pn-14,0),30,null,null,false);currPN=pn;var imgobj=DataStore.getImgByPn(pn,null,null,false);if(imgobj.is){currISPN=(isPn>=0?isPn:0)}else{currISPN=-1}}function getImgByPN(pn,imgPn,needCache){var callBackFun;var args=[];var data;if(needCache==true){callBackFun=function(data,tempPn,tempISPN,pre,post){cacheImg(data,tempPn,pre,post);imgSetDataCallBack(data,tempPn,tempISPN)};args=[pn,imgPn,IMG_CACHE_PRE,IMG_CACHE_POST]}if(imgPn>=0){data=DataStore.getImgSetImg(pn,imgPn,callBackFun,args,false)}else{data=DataStore.getImgByPn(pn,callBackFun,args,false)}return data}function cacheImg(imgData,pn,pre,post){for(var j=0;j<(pn-pre-5);j++){var data=imgData[j];if(typeof data!="undefined"&&typeof data.imgsrc!="undefined"&&data.imgsrc!=null){data.imgsrc.detachEvent("onload",loadHandler);data.imgsrc.detachEvent("onerror",errorHandler);data.imgsrc.removeAttribute("src");if(Browser.isIE>0){var div=document.createElement("DIV");div.appendChild(data.imgsrc);div.innerHTML="";div=null}data.imgsrc=null}}var isCache=true;for(var i=(pn-pre);i<(pn+post+1);i++){var data=imgData[i];if(!data){continue}if(data.is&&isCache&&i!=pn){cacheImgSetPn=i;isCache=false;if(data.imgSet&&!data.isImgSetCached){data.isImgSetCached=true;setTimeout((function(dataItem){return function(){cacheImg(dataItem.imgSet.data,0,IMG_CACHE_PRE,IMG_CACHE_POST)}})(data),1)}}if(data.objURL&&(typeof data.imgsrc=="undefined"||data.imgsrc==null)){var data=imgData[i];data.imgsrc=document.createElement("IMG");data.imgLoadStart=(new Date()).getTime();data.loadState=-1;var load=(function(){var index=i;return function(){var a=index;loadHandler(imgData[index])}})();var err=(function(){var index=i;return function(){var a=index;errorHandler(imgData[index])}})();data.imgsrc.attachEvent("onload",load);data.imgsrc.attachEvent("onerror",err);data.imgsrc.src=imgData[i].objURL;if(data.is&&!data.imgSet){DataStore.getImgSetData(data.pageNum,imgSetDataCallBack,[data.pageNum],true)}}}}function loadHandler(data){if(data.ok){data.imgLoadEnd=(new Date()).getTime();data.ok(data.imgLoadStart,data.imgLoadEnd,data)}else{data.loadState=1;data.imgLoadEnd=(new Date()).getTime()}}function errorHandler(data){data.imgLoadEnd=(new Date()).getTime();if(data.err){data.err(data.imgLoadStart,data.imgLoadEnd)}else{data.loadState=0}}function getImgsByPn(pn,ispn,num){var temp=[];if(ispn!=null&&ispn>=0){temp=DataStore.getImgSetImgs(pn,ispn,num,null,null,false)}else{temp=DataStore.getImgs(pn,num,null,null,false)}return BD.IMG.cloneObj(temp)}function imgSetDataCallBack(imgData,pn){var temData=imgData[pn].imgSet;if(!temData){return }if(cacheImgSetPn==pn||pn==currPN){cacheImg(temData.data,currISPN,IMG_CACHE_PRE,IMG_CACHE_POST)}cacheSmallImg(temData.data,5);if(pn==currPN){cacheImg(imgData[pn].imgSet.data,currISPN,IMG_CACHE_PRE,IMG_CACHE_POST)}}function cacheSmallImg(data,cacheNum){var i=0;for(;i<cacheNum;i++){var imgData=data[i];if(!imgData||!imgData.thumbURL){break}var tempLoadImg=new Image();tempLoadImg.src=imgData.thumbURL;imgData.tempLoadImg=tempLoadImg}}function init(){currPN=BD.IMG.gconf.realPn;listNum=parseInt(searchConf.ln);var hashValue=trim(window.location.hash);if(hashValue.length>0){hashValue=hashValue.replace("#pn","").split("&");var pnHashValue=parseInt(hashValue[0]);if(!isNaN(pnHashValue)&&pnHashValue>=0&&pnHashValue<listNum){currPN=pnHashValue}}var temppn=currPN;if(temppn-14>=0){temppn=temppn-14}else{temppn=0}currMaxPn=temppn;currMinPn=temppn;DataStore.getImgs(temppn,30,null,null,false);var imgSetList=getCurrISListNum();var isPnHashValue=parseInt(hashValue[1]);if(!isNaN(isPnHashValue)&&isPnHashValue>=0&&isPnHashValue<imgSetList){currISPN=isPnHashValue}if(BD.IMG.gconf.realPn==currPN){var tempDate=BD.IMG.curObj;tempDate.pageNum=currPN;DataStore.setImg(tempDate.pageNum,tempDate);tempDate.fromURL=trim(tempDate.fromURL);tempDate.objURL=trim(tempDate.objURL);tempDate.fromPageTitle=trim(tempDate.fromPageTitle);tempDate.is=searchConf.is;if(tempDate.is=="0,0"){tempDate.is=""}if(tempDate.is&&currISPN<0){currISPN=0}}}return{init:init,getCurrentPN:getCurrentPN,resetCurrentPN:resetCurrentPN,getImgByPN:getImgByPN,getImgsByPn:getImgsByPn,getCurrentImgData:getCurrentImgData,getCurrISPN:getCurrISPN,getCurrentImgSetData:getCurrentImgSetData,getCurrISListNum:getCurrISListNum,getISListNum:getISListNum,getCurrIS:getCurrIS,getListNum:getListNum}})();window.DataManager=DataManager;var DataStore=(function(){var indexStore=[];var blocks=[];var BLOCK_SIZE=30;var listNum=0;function getImg(pn,callback,args,async){var data=indexStore[pn];if(data){args=(args||[]);var tempargs=args.concat();tempargs.unshift(indexStore);callback&&callback.apply(window,tempargs)}else{fetchResultData(pn,pn,{},callback,args,async)}if(!async){return indexStore[pn]}}function getSuitImg(pn,suitPn,callback,args,async){var suitData=getSuitData(pn,callback,args,async);if(!async){return suitData.data[suitPn]}}function getImgs(pn,num,callback,args,async){fetchResultData(pn,pn+num-1,{},callback,args,async);if(!async){var imgObjs=[];for(var i=pn;i<pn+num&&i<listNum;i++){imgObjs.push(indexStore[i])}return imgObjs}}function getSuitImgs(pn,suitPn,num,callback,args,async){var suitData=getSuitData(pn,callback,args,async);if(!async){var imgObjs=[];var data=suitData.data;for(var i=suitPn;i<suitPn+num&&i<suitData.listNum;i++){imgObjs.push(data[i])}return imgObjs}}function getSuitData(pn,callback,args,async){var tempCallback=function(){var imgobj=indexStore[pn];if(imgobj&&imgobj.is&&imgobj.is!="0,0"){fetchImgObjAttrData(pn,"imgSet",{is:imgobj.is,pn:0,rn:60},callback,args,async)}else{args=(args||[]);var tempargs=args.concat();tempargs.unshift(indexStore);callback&&callback.apply(window,tempargs)}};var imgobj=getImg(pn,tempCallback,args,async);if(!async){return imgobj.imgSet}}function getListNum(){return listNum}function getSuitListNum(pn){var suitData=getSuitData(pn,null,null,false);return suitData?suitData.listNum:0}function storeData(startPn,requestBlocks,data){if(typeof data=="string"){try{eval("var tempData="+data)}catch(e){return }}else{var tempData=data}listNum=tempData.listNum;for(var i=0;i<tempData.data.length-1;i++){var temp=tempData.data[i];temp.fromURL=trim(temp.fromURL);temp.objURL=trim(temp.objURL);temp.fromPageTitle=trim(temp.fromPageTitle);if(temp.is=="0,0"){temp.is=""}indexStore[temp.pageNum]=temp}for(var i=0,len=requestBlocks.length;i<len;i++){blocks[requestBlocks[i]].state=2}return blocks[requestBlocks[requestBlocks.length-1]]}function setImgObjAttribute(pn,attrName,data){try{eval("var temData="+data)}catch(e){var temData=data}for(var i=0;i<temData.data.length-1;i++){var temp=temData.data[i];temp.fromURL=trim(temp.fromURL);temp.objURL=trim(temp.objURL);temp.fromPageTitle=trim(temp.fromPageTitle);temp.is=""}indexStore[pn][attrName]=temData;return indexStore[pn]}function calcDataBlock(startPN,endPn,status){var tempblocks=[];var startBLock,endBlock;endPn=((listNum!=0&&endPn>listNum)?listNum:endPn);startBLock=Math.floor(startPN/BLOCK_SIZE);endBlock=Math.floor(endPn/BLOCK_SIZE);for(var i=startBLock,n=endBlock;i<=endBlock;i++){var blockStatus=(blocks[i]?blocks[i].state:0);if(blockStatus!=2){clearCallBack(blocks[i]);tempblocks.push(i)}}return tempblocks}function fetchResultData(startPN,endPn,querys,callback,args,async){var relateBlocks=calcDataBlock(startPN,endPn);args=(args||[]);if(relateBlocks.length==0){var tempargs=args.concat();tempargs.unshift(indexStore);callback&&callback.apply(window,tempargs);return }var startPn=-1;var rn=0;var requestBlocks=[];for(var i=0,len=relateBlocks.length;i<len;i++){var blockIndex=relateBlocks[i];var block=blocks[blockIndex];var state=(block?block.state:0);if(block==0||block==undefined){(startPn<0)&&(startPn=blockIndex*BLOCK_SIZE);rn++;blocks[blockIndex]={state:1};requestBlocks.push(blockIndex)}}bind(callback,relateBlocks,args);rn=rn*BLOCK_SIZE;querys.rn=rn;querys.pn=startPn;var url=getUrl(querys);var storeDataFun=function(data){return storeData(startPn,requestBlocks,data)};fetchData(url,storeDataFun,callback,args,relateBlocks,async)}function fetchImgObjAttrData(pn,attrName,querys,callback,args,async){args=(args||[]);if(indexStore[pn][attrName]){var tempargs=args.concat();tempargs.unshift(indexStore);callback&&callback.apply(window,tempargs);return }var url=getUrl(querys);var callBackObj={callBackFun:callback,callBackArgs:args};indexStore[pn].callBackObj=callBackObj;var storeDataFun=function(data){return setImgObjAttribute(pn,attrName,data)};fetchData(url,storeDataFun,callback,args,null,async)}function bind(callback,requestBlocks,args){var callBackObj={requestBlocks:requestBlocks,callBackFun:callback,callBackArgs:args};for(var i=0,len=requestBlocks.length;i<len;i++){var block=blocks[requestBlocks[i]];clearCallBack(block);block.callBackObj=callBackObj}}function checkRelateBlock(obj){var isStroedData=true;var callBackObj=((obj&&obj.callBackObj)||{});if(callBackObj&&callBackObj.requestBlocks){var requestBlocks=callBackObj.requestBlocks;for(var i=0,len=requestBlocks.length;i<len;i++){var block=blocks[requestBlocks];if(block!=2){isStroeData=false;break}}}return isStroedData}function clearCallBack(obj){if(!obj){return }var callBackObj=(obj.callBackObj||{});if(callBackObj&&callBackObj.requestBlocks){var requestBlocks=callBackObj.requestBlocks;var len=requestBlocks.length;for(var i=0;i<len;i++){var block=blocks[requestBlocks];block.callBackObj=null}}else{obj.callBackObj=null}}function fetchData(url,storeDataFun,callback,args,relateBlocks,async){var callbackFun;var handleMap={"true":function(){callbackFun=function(data){var storedObj=storeDataFun(data);if(checkRelateBlock(storedObj)){var args=(storedObj.callBackObj.callBackArgs||[]);var tempargs=args.concat();tempargs.unshift(indexStore);storedObj.callBackObj.callBackFun&&storedObj.callBackObj.callBackFun.apply(window,tempargs);clearCallBack(storedObj)}}},"false":function(){callbackFun=function(data){var storedObj=storeDataFun(data);var args=(storedObj.callBackObj.callBackArgs||[]);var tempargs=args.concat();tempargs.unshift(indexStore);storedObj.callBackObj.callBackFun&&storedObj.callBackObj.callBackFun.apply(window,tempargs)}}};handleMap[async]();net.getRequest(url,callbackFun,async,[])}function getUrl(querys){var quStr=window.location.search.substring(1);var searchConf=query2Json(quStr);var queryParam={};queryParam.tn="baiduimagejson";queryParam.ct="201326592";queryParam.cl=searchConf.cl;queryParam.lm=searchConf.lm;queryParam.word=BD.IMG.gconf.word;queryParam.z=searchConf.z;queryParam.rn=30;queryParam.ic=searchConf.ic||"";queryParam.s=searchConf.s||"";queryParam.se=searchConf.se||"1";queryParam.tab=searchConf.tab||"";queryParam.width=searchConf.width||"";queryParam.height=searchConf.height||"";queryParam.face=searchConf.face||"";queryParam.istype=searchConf.istype||"";for(var i in querys){queryParam[i]=querys[i]}var queryStr=json2Query(queryParam);var url="?"+queryStr+"&"+(new Date()).getTime();return url}function setImg(pn,imgobj){indexStore[pn]=imgobj}return{getImgByPn:getImg,getImgSetImg:getSuitImg,getImgs:getImgs,getImgSetData:getSuitData,getListNum:getListNum,getImgSetListNum:getSuitListNum,getImgSetImgs:getSuitImgs,setImg:setImg}})();window.DataStore=DataStore;BD.IMG.StatCof=(function(){var searchConf=query2Json(window.location.search.substring(1));return{host:"http://p.baidu.com/",lcHost:"http://lc.baidu.com/",tn:BD.IMG.gconf.tn,q:BD.IMG.gconf.word,cl:searchConf.cl,lm:searchConf.lm,z:searchConf.z,fr:searchConf.fr,fmq:searchConf.fmq,tab:searchConf.tab,ad:BD.IMG.gconf.isEcom}})();BD.IMG.statistic=(function(){var ASYN_WAIT_TIME=100;function monitorRequest(host,query){var img=window["__log__"+(new Date()).getTime()]=document.createElement("img");img.src=host+"?"+query+"&"+new Date()*Math.random()}function DetailImgStat(event,args){var imgData=DataManager.getCurrentImgSetData();var is=DataManager.getCurrIS();var listNum=DataManager.getCurrISListNum();var host=BD.IMG.StatCof.host+"5.gif";var lastImgObj=DetailImg.getLastImgObj();var lastImgState=(lastImgObj?lastImgObj.loadState:-1);var lastImgViewTime=(lastImgObj?(new Date()).getTime()-lastImgObj.imgViewStart:-1);var query={};query.p=args.p;query.q=BD.IMG.StatCof.q;query.pn=imgData.pageNum;query.cl=BD.IMG.StatCof.cl;query.lm=BD.IMG.StatCof.lm;query.z=BD.IMG.StatCof.z;query.tn=BD.IMG.StatCof.tn;query.ad=BD.IMG.StatCof.ad;query.di=imgData.di;query.u=imgData.objURL;query.f=imgData.fromURL;query.is=is||"";query.isln=listNum||0;query.tp=args.tp;query.keyb=args.keyb||"";query.dp=args.dp||"";query.fr=BD.IMG.StatCof.fr;query.fmq=BD.IMG.StatCof.fmq||"";query.tab=BD.IMG.StatCof.tab||"";query.fp=args.fp||"";query.lis=lastImgState;query.livt=lastImgViewTime;return{host:host,query:query,isAsyn:false}}function albumStat(event,args){var host=BD.IMG.StatCof.host+"5.gif";var imgData=DataManager.getCurrentImgSetData();var listNum=DataManager.getCurrISListNum();var is=DataManager.getCurrIS();var lastImgObj=DetailImg.getLastImgObj();var lastImgState=(lastImgObj?lastImgObj.loadState:-1);var lastImgViewTime=(lastImgObj?(new Date()).getTime()-lastImgObj.imgViewStart:-1);var query={};query.p=args.p;query.q=BD.IMG.StatCof.q;query.pn=imgData.pageNum;query.cl=BD.IMG.StatCof.cl;query.lm=BD.IMG.StatCof.lm;query.z=BD.IMG.StatCof.z;query.tn=BD.IMG.StatCof.tn;query.ad=BD.IMG.StatCof.ad;query.di=imgData.di;query.u=imgData.objURL;query.f=imgData.fromURL;query.nb=args.nb;query.is=is||"";query.isln=listNum||0;query.fr=BD.IMG.StatCof.fr;query.fmq=BD.IMG.StatCof.fmq||"";query.tab=BD.IMG.StatCof.tab||"";query.fp=args.fp||"";query.lis=lastImgState;query.livt=lastImgViewTime;return{host:host,query:query,isAsyn:false}}function jsonTemplateStat(event,args){var host=BD.IMG.StatCof.host+"5.gif";var imgData=DataManager.getCurrentImgSetData();var query={};query.p=args.p;query.q=BD.IMG.StatCof.q;query.pn=imgData.pageNum;query.cl=BD.IMG.StatCof.cl;query.lm=BD.IMG.StatCof.lm;query.z=BD.IMG.StatCof.z;query.tn="baiduimagejson";query.ad=BD.IMG.StatCof.ad;query.fr=BD.IMG.StatCof.fr;query.tab=BD.IMG.StatCof.tab||"";return{host:host,query:query,isAsyn:false}}function fromSiteStat(event,args){var host=BD.IMG.StatCof.host+"5.gif";var imgData=DataManager.getCurrentImgSetData();var query={};query.p=args.p;query.q=BD.IMG.StatCof.q;query.pn=imgData.pageNum;query.cl=BD.IMG.StatCof.cl;query.lm=BD.IMG.StatCof.lm;query.z=BD.IMG.StatCof.z;query.tn=BD.IMG.StatCof.tn;query.f=imgData.fromURL;query.fr=BD.IMG.StatCof.fr;query.tab=BD.IMG.StatCof.tab||"";return{host:host,query:query,isAsyn:false}}function spacePicStat(event,args){var host=BD.IMG.StatCof.host+"5.gif";var query={};query.q=BD.IMG.StatCof.q;query.p=args.p;return{host:host,query:query,isAsyn:false}}function baiduToolBarStat(event,args){var host=BD.IMG.StatCof.host+"5.gif";var query={};query.q=BD.IMG.StatCof.q;query.p=args.p;return{host:host,query:query,isAsyn:false}}function flashStat(event,args){var host=BD.IMG.StatCof.host+"5.gif";var query={};query.q=BD.IMG.StatCof.q;query.p=args.p;query.op=(args.op||"");return{host:host,query:query,isAsyn:false}}var positionHandle={12:DetailImgStat,13:albumStat,14:jsonTemplateStat,15:fromSiteStat,21:spacePicStat,22:spacePicStat,23:baiduToolBarStat,28:flashStat};function send(event,position,args){var e=event||window.event;if(typeof args=="undefined"){args={}}var handler=positionHandle[position];if(typeof handler!="undefined"){args.p=position;var result=handler.apply(this,[e,args]);var host=result.host;var query=result.query;if(typeof query=="object"){query=json2Query(query)}var isAsyn=result.isAsyn;monitorRequest(host,query);if(isAsyn){e.returnValue=false;if(e.preventDefault){e.preventDefault()}setTimeout(function(){location.href=o.href},ASYN_WAIT_TIME)}}}function setHandle(position,handle){positionHandle[position]=handle}return{send:send,setHandle:setHandle}})();window.statistic=BD.IMG.statistic;var Ecom=function(){var isRefreshing=false;var quStr=window.location.search.substring(1);var searchConf=query2Json(quStr);var ecomTimer;var queryParam={ct:"520093696",tn:"baiduimageecom",word:BD.IMG.gconf.word,stn:""};function refresh(){if(isRefreshing){return }isRefreshing=true;queryParam.stn=BD.IMG.gconf.tn;var queryStr=json2Query(queryParam);var url=host+"?"+queryStr+"&"+(new Date().getTime());net.getRequest(url,refreshCallback,true)}function refreshCallback(responseText){var response=trim(responseText);if(response.length>0){G("imContainer").innerHTML=responseText}isRefreshing=false}return{refresh:refresh}}();var AlbumControl=(function(){var currPn;var currImgSetPn;var AlbumConfig;var picHeight=99;var picMargin=5;var albumBtnHeight=32;function init(config){AlbumConfig=config;resizeAlbum()}function scrollToPn(pn,imgSetPn){if(currPn!=pn){Album.scrollToPn(pn);ImgsetAlbum.toggle(pn);ImgsetAlbum.scrollToPn(pn,imgSetPn)}else{if(imgSetPn!=currImgSetPn){ImgsetAlbum.scrollToPn(pn,imgSetPn)}}currPn=pn;currImgSetPn=imgSetPn}function resizeAlbum(size){size=size||sizeHandle.get();var h=size.detailImgHeight+size.imgFromHeight-2*albumBtnHeight;var currDispNum=(h+picMargin)/picHeight;Album.reSizealbum(currDispNum,h,size.imgContainerWidth-sizeConfig.albumWidth);ImgsetAlbum.reSizealbum(currDispNum,size.detailImgWidth)}return{init:init,resizeAlbum:resizeAlbum,scrollToPn:scrollToPn}})();var Album=(function(){var listNum;var albumObj;var slidePre;var slideNext;var ImgSwitcher;var AlbumConfig;var maxDispNum=0;var currDispNum=0;var displayNum=0;var lastCurrDispNum=0;var picHeight=99;var picMargin=5;var albumBtnHeight=32;var slide=slideClass();var albumState={topImgPN:"",isBrowse:false,isCanBrowse:true,isBrowsing:false,browseQueue:0};function setCurrDispNum(size){size=size||sizeHandle.get();var h=size.detailImgHeight+size.imgFromHeight-2*albumBtnHeight;currDispNum=(h+picMargin)/picHeight;displayNum=Math.ceil(currDispNum)}function isCurrentPnDisplay(pn,topPn,dispNum){return pn-topPn+1>AlbumConfig.displayPosition+AlbumConfig.preCacheMaxNum&&topPn+Math.floor(dispNum)-AlbumConfig.nextCacheMaxNum>pn}function reSizealbum(cDispNum,h,left){var listObj=G("album");listObj.style.left=left+"px";currDispNum=cDispNum;var n=Math.ceil(cDispNum+AlbumConfig.preCacheMaxNum+AlbumConfig.nextCacheMaxNum-maxDispNum);var tempPn=albumState.topImgPN;var currentPN=DataManager.getCurrentPN();if(n>0){tempPn=tempPn+maxDispNum;addAlbumImg(tempPn,n);maxDispNum=Math.ceil(currDispNum+AlbumConfig.preCacheMaxNum+AlbumConfig.nextCacheMaxNum);displayNum=Math.ceil(currDispNum)}lastCurrDispNum=currDispNum;G("smallImgs").style.height=h+"px"}function addAlbumImg(tempPn,n){var initImgData;var currentPN=DataManager.getCurrentPN();if(tempPn>0){initImgData=DataManager.getImgsByPn(tempPn,null,n)}else{initImgData=DataManager.getImgsByPn(0,null,n)}for(var i=0,j=0;i<n;i++,tempPn++){var tempDivObj=document.createElement("div");if(tempPn<0||tempPn>listNum){tempDivObj.className="noImg"}else{if(tempPn==listNum){tempDivObj.className="noImgLast"}else{var temImg=initImgData[j];j++;if(temImg.pageNum==currentPN){tempDivObj.className="select"}else{tempDivObj.className="noselect"}tempDivObj.innerHTML=getImgeHtml(temImg);tempDivObj.title=temImg.fromPageTitle.replace(/<.*?>/g,"")}}tempDivObj.id="pn_"+tempPn;albumObj.appendChild(tempDivObj)}}function browsePre(){if(albumState.isBrowsing==true){return }if(albumState.topImgPN==-AlbumConfig.preCacheMaxNum){albumState.isBrowse=false;albumState.isCanBrowse=true;albumState.browseQueue=0;return }if(albumState.browseQueue!=0){albumState.browseQueue--}albumState.isBrowsing=true;if(albumState.topImgPN<=0){slide.pre(null,albumState.topImgPN-1);albumState.topImgPN--}if(albumState.topImgPN>0){slide.pre(DataManager.getImgByPN(albumState.topImgPN-1),albumState.topImgPN-1);albumState.topImgPN--}return }function browseNext(){if(albumState.isBrowsing==true){return }if(albumState.topImgPN+AlbumConfig.preCacheMaxNum+AlbumConfig.displayPosition>=listNum){albumState.isBrowse=false;albumState.isCanBrowse=true;albumState.browseQueue=0;return }if(albumState.browseQueue!=0){albumState.browseQueue++}albumState.isBrowsing=true;var nextImgPn=albumState.topImgPN+AlbumConfig.preCacheMaxNum+displayNum+AlbumConfig.nextCacheMaxNum;if(nextImgPn>=listNum){slide.next(null,nextImgPn);albumState.topImgPN++}if(nextImgPn<listNum){slide.next(DataManager.getImgByPN(nextImgPn),nextImgPn);albumState.topImgPN++}return }function browsePreCallback(){albumState.isCanBrowse=true;albumState.isBrowsing=false;if(albumState.topImgPN<=-AlbumConfig.preCacheMaxNum){if(slidePre.currClass&&slidePre.currClass!="preNone"){slidePre.className="preNone";slidePre.currClass="preNone"}}if(slideNext.currClass&&slideNext.currClass!="nextNormal"){slideNext.className="nextNormal";slideNext.currClass="nextNormal"}if(albumState.isBrowse||albumState.browseQueue!=0){if(albumState.browseQueue<0){browseNext()}else{browsePre()}}else{resetImgSelectCalss()}}function browseNextCallback(){albumState.isCanBrowse=true;albumState.isBrowsing=false;if(albumState.topImgPN+AlbumConfig.displayPosition+AlbumConfig.preCacheMaxNum==listNum){if(slideNext.currClass&&slideNext.currClass!="nextNone"){slideNext.className="nextNone";slideNext.currClass="nextNone"}}if(slidePre.currClass&&slidePre.currClass!="preNormal"){slidePre.className="preNormal";slidePre.currClass="preNormal"}if(albumState.isBrowse||albumState.browseQueue!=0){if(albumState.browseQueue<=0){browseNext()}else{browsePre()}}else{resetImgSelectCalss()}}function resetImgSelectCalss(){var imglist=albumObj.children;var currentPN=DataManager.getCurrentPN();for(var i=0,n=imglist.length;i<n;i++){var tempDivObj=imglist[i];var tempPn=tempDivObj.id.replace(/pn_/g,"");if(tempPn==currentPN&&tempDivObj.className!="select"){tempDivObj.className="select"}else{if(tempPn!=currentPN&&tempDivObj.className=="select"){tempDivObj.className="noselect"}}}}function browse(type){if(albumState.browseQueue!=0){return }if(albumState.isBrowse){return }albumState.isBrowse=true;if(type=="pre"){albumState.browseQueue=Math.floor(currDispNum);browsePre()}if(type=="next"){albumState.browseQueue=-Math.floor(currDispNum);browseNext()}}function stopBrowse(){albumState.isBrowse=false}function scrollToPn(pn){var temTopPN=pn-AlbumConfig.displayPosition-AlbumConfig.preCacheMaxNum+1;if(temTopPN<-AlbumConfig.preCacheMaxNum){temTopPN=-AlbumConfig.preCacheMaxNum}if(temTopPN+AlbumConfig.preCacheMaxNum+AlbumConfig.displayPosition>listNum){temTopPN=listNum-AlbumConfig.preCacheMaxNum-AlbumConfig.displayPosition}albumState.browseQueue=albumState.topImgPN-temTopPN;if(Math.abs(albumState.browseQueue)<displayNum){if(albumState.browseQueue>0){browsePre()}else{if(albumState.browseQueue<0){browseNext()}}}else{albumState.topImgPN=temTopPN;resetAlbumImg(temTopPN);albumState.browseQueue=0}}function resetAlbumImg(tempPn,num){tempPn=tempPn||albumState.topImgPN;num=num||maxDispNum;var currentPN=DataManager.getCurrentPN();var initImgData,imglist;if(tempPn>0){initImgData=DataManager.getImgsByPn(tempPn,null,num)}else{initImgData=DataManager.getImgsByPn(0,null,num)}imglist=albumObj.children;for(var i=0,j=0,n=imglist.length;i<n;i++,tempPn++){var tempDivObj=imglist[i];if(tempPn<0||tempPn>listNum){tempDivObj.className="noImg";tempDivObj.innerHTML=""}else{if(tempPn==listNum){tempDivObj.className="noImgLast";tempDivObj.innerHTML=""}else{var temImg=initImgData[j];j++;if(temImg.pageNum==currentPN){tempDivObj.className="select"}else{tempDivObj.className="noselect"}tempDivObj.innerHTML=getImgeHtml(temImg);tempDivObj.title=temImg.fromPageTitle.replace(/<.*?>/g,"")}}tempDivObj.id="pn_"+tempPn}albumState.browseQueue=0}function wheel(event){if(albumState.browseQueue!=0){return }var delta=0;var e=event||window.event;if(e.wheelDelta){delta=event.wheelDelta/120}else{if(e.detail){delta=-event.detail/3}}if(delta&&delta>0){if(albumState.isCanBrowse&&albumState.browseQueue==0){albumState.isCanBrowse=false;browsePre()}}else{if(delta&&delta<0){if(albumState.isCanBrowse&&albumState.browseQueue==0){albumState.isCanBrowse=false;browseNext()}}}if(e.preventDefault){e.preventDefault()}e.returnValue=false}function getImgeHtml(ImgObj){var imgHtml="";var isImgClass="";var maxSize=90;if(!!ImgObj){if(ImgObj.is){isImgClass="class='isImg'";maxSize=70}var offset=zoomImg(ImgObj.width,ImgObj.height,maxSize);imgHtml="<table "+isImgClass+'cellspacing="0"><tr><td align="center" valign="middle"><img name="'+ImgObj.pageNum+'" title="'+ImgObj.fromPageTitle.replace(/<.*?>/g,"").replace(/"/g,"&quot")+'" style="width:'+offset.width+"px;height:"+offset.height+'px" onload="this.style.display=\'inline\'" onerror="BD.IMG.smallImgErr(this)" src="'+ImgObj.thumbURL+'"></tr></table>'}return imgHtml}function __imgClick(e){var e=e||window.event;var obj=e.target||e.srcElement;if(obj!=albumObj){if(obj.nodeName!="IMG"){var chlidren=obj.getElementsByTagName("IMG");if(chlidren.length==0){return }obj=chlidren[0]}var pn=parseInt(obj.name);var currObj=DataManager.getImgByPN(pn);currObj.tp=null;currObj.nb=7;var imgSetPn=(currObj.is?0:-1);if(ImgSwitcher(pn,imgSetPn)){BD.IMG.statistic.send(e,13,{nb:7})}}}function keyTurnPage(e){var e=e||window.event;var keycode=e.keyCode||e.which;var currentPN=DataManager.getCurrentPN();var listNum=DataManager.getListNum();if(e.ctrlKey&&keycode==AlbumConfig.nexPageKey){if(currentPN<listNum-1){if(window.SwitchPageTimer){clearTimeout(window.SwitchPageTimer)}window.SwitchPageTimer=setTimeout(function(){ImgSwitcher(currentPN+1)},300)}if(e.preventDefault){e.preventDefault()}e.returnValue=false}if(e.ctrlKey&&keycode==AlbumConfig.prePageKey){if(currentPN>0){if(window.SwitchPageTimer){clearTimeout(window.SwitchPageTimer)}window.SwitchPageTimer=setTimeout(function(){ImgSwitcher(currentPN-1)},300)}if(e.preventDefault){e.preventDefault()}e.returnValue=false}}function init(config){AlbumConfig=config;albumObj=G("imgList");slidePre=G("slidePre");slideNext=G("slideNext");slide.setAlbum(albumObj);slide.setSlideConfig({distance:94,imgIdStr:"pn_"});slide.setPreCallBack(browsePreCallback);slide.setNextCallBack(browseNextCallback);slide.setImgHtml(getImgeHtml);slide.setCurrentPnFun(DataManager.getCurrentPN);slide.setGetListNumFun(DataManager.getListNum);var currentPN=DataManager.getCurrentPN();listNum=DataManager.getListNum();var size=sizeHandle.get();setCurrDispNum(size);if(currentPN-AlbumConfig.preCacheMaxNum-AlbumConfig.displayPosition+1>-AlbumConfig.preCacheMaxNum){albumState.topImgPN=currentPN-AlbumConfig.preCacheMaxNum-AlbumConfig.displayPosition+1}else{albumState.topImgPN=-AlbumConfig.preCacheMaxNum}if(albumState.topImgPN<=-AlbumConfig.preCacheMaxNum){slidePre.className="preNone";slidePre.currClass="preNone"}else{slidePre.className="preNormal";slidePre.currClass="preNormal"}if(albumState.topImgPN>=listNum-AlbumConfig.displayPosition-AlbumConfig.preCacheMaxNum){slideNext.className="nextNone";slideNext.currClass="nextNone"}else{slideNext.className="nextNormal";slideNext.currClass="nextNormal"}slidePre.attachEvent("onmouseout",stopBrowse);slidePre.attachEvent("onmouseup",stopBrowse);slidePre.attachEvent("onmouseover",function(){if(albumState.topImgPN!=-AlbumConfig.preCacheMaxNum){slidePre.className="preHover";slidePre.currClass="preHover"}});slidePre.attachEvent("onmouseout",function(){if(albumState.topImgPN!=-AlbumConfig.preCacheMaxNum){slidePre.className="preNormal";slidePre.currClass="preNormal"}});slidePre.attachEvent("onmousedown",function(e){e=e||window.event;browse("pre");if(e.preventDefault){e.preventDefault()}e.returnValue=false});slideNext.attachEvent("onmouseout",stopBrowse);slideNext.attachEvent("onmouseup",stopBrowse);slideNext.attachEvent("onmousedown",function(e){e=e||window.event;browse("next");if(e.preventDefault){e.preventDefault()}e.returnValue=false});slideNext.attachEvent("onmouseover",function(){var currentPN=DataManager.getCurrentPN();if(albumState.topImgPN<listNum-AlbumConfig.displayPosition-AlbumConfig.preCacheMaxNum){slideNext.className="nextHover";slideNext.currClass="nextHover"}});slideNext.attachEvent("onmouseout",function(){var currentPN=DataManager.getCurrentPN();if(albumState.topImgPN<listNum-AlbumConfig.displayPosition-AlbumConfig.preCacheMaxNum){slideNext.className="nextNormal";slideNext.currClass="nextNormal"}});if(Browser.isGecko){albumObj.attachEvent("DOMMouseScroll",wheel)}else{albumObj.attachEvent("onmousewheel",wheel)}albumObj.attachEvent("onclick",__imgClick)}function isCanSwitch(){if(Math.abs(albumState.browseQueue)>=displayNum-BD.IMG.albumConf.displayPosition){return false}return true}return{init:init,browse:browse,stopBrowse:stopBrowse,scrollToPn:scrollToPn,setSwitcher:function(switcher){ImgSwitcher=switcher},isCanSwitch:isCanSwitch,reSizealbum:reSizealbum,getImgeHtml:getImgeHtml}})();var ImgsetAlbum=(function(){var albumObj;var slidePre;var slideNext;var imgSetInfo;var imgList;var arrow;var ImgSwitcher;var slide=slideClass();var listNum;var isdisplay=false;var AlbumConfig;var currPn=0;var maxDispNum=0;var currDispNum=0;var displayNum=0;var lastCurrDispNum=0;var picHeight=99;var picMargin=5;var albumBtnHeight=32;var albumleft;var imgsetAlbumWidth=100;var albumState={topImgPN:"",isBrowse:false,isCanBrowse:true,isBrowsing:false,browseQueue:0};function setCurrDispNum(size){size=size||sizeHandle.get();var h=size.detailImgHeight-2*albumBtnHeight;displayNum=currDispNum=Math.floor((h+picMargin)/picHeight)}function init(config){AlbumConfig=config;albumObj=G("isimgList");imgSetObj=G("isAlbum");slidePre=G("isSlidePre");slideNext=G("isSlideNext");imgSetInfo=G("isInfo");arrow=G("arrow");slide.setAlbum(albumObj);slide.setSlideConfig({distance:81,imgIdStr:"isPn_"});slide.setPreCallBack(browsePreCallback);slide.setNextCallBack(browseNextCallback);slide.setImgHtml(getImgeHtml);slide.setCurrentPnFun(DataManager.getCurrISPN);slide.setGetListNumFun(DataManager.getCurrISListNum);setCurrDispNum();slidePre.attachEvent("onmousedown",function(e){e=e||window.event;browse("pre");if(e.preventDefault){e.preventDefault()}e.returnValue=false});slidePre.attachEvent("onmouseup",stopBrowse);slideNext.attachEvent("onmousedown",function(e){e=e||window.event;browse("next");if(e.preventDefault){e.preventDefault()}e.returnValue=false});slideNext.attachEvent("onmouseup",stopBrowse);albumObj.attachEvent("onclick",__imgClick);slidePre.attachEvent("onmouseover",function(){if(albumState.topImgPN!=-AlbumConfig.preCacheMaxNum){slidePre.className="preHover";slidePre.currClass="preHover"}});slidePre.attachEvent("onmouseout",function(){if(albumState.topImgPN!=-AlbumConfig.preCacheMaxNum){slidePre.className="preNormal";slidePre.currClass="preNormal"}});slideNext.attachEvent("onmouseover",function(){var currentPN=DataManager.getCurrentPN();if(albumState.topImgPN+displayNum+AlbumConfig.preCacheMaxNum<listNum){slideNext.className="nextHover";slideNext.currClass="nextHover"}});slideNext.attachEvent("onmouseout",function(){var currentPN=DataManager.getCurrentPN();if(albumState.topImgPN+displayNum+AlbumConfig.preCacheMaxNum<listNum){slideNext.className="nextNormal";slideNext.currClass="nextNormal"}})}function setListNum(num){listNum=num;if(listNum>=currDispNum){displayNum=currDispNum}else{displayNum=listNum}}function setImgSetInfo(pn){var currISListNum=DataManager.getISListNum(pn);var currISPN=DataManager.getCurrISPN()+1;imgSetInfo.innerHTML=currISPN+"/"+currISListNum}function browse(type){if(listNum<=displayNum){return }if(albumState.browseQueue!=0){return }if(albumState.isBrowse){return }albumState.isBrowse=true;if(type=="pre"){albumState.browseQueue=displayNum;browsePre()}if(type=="next"){albumState.browseQueue=-displayNum;browseNext()}}function stopBrowse(){albumState.isBrowse=false}function browsePre(){if(albumState.isBrowsing==true){return }if(albumState.topImgPN<=-AlbumConfig.preCacheMaxNum){albumState.isBrowse=false;albumState.isCanBrowse=true;albumState.browseQueue=0;return }if(albumState.browseQueue!=0){albumState.browseQueue--}albumState.isBrowsing=true;if(albumState.topImgPN<=0){slide.pre(null,albumState.topImgPN-1);albumState.topImgPN--}if(albumState.topImgPN>0){slide.pre(DataManager.getImgByPN(currPn,albumState.topImgPN-1),albumState.topImgPN-1);albumState.topImgPN--}return }function browseNext(){if(albumState.isBrowsing==true){return }if(albumState.topImgPN+displayNum+AlbumConfig.preCacheMaxNum>=listNum){albumState.isBrowse=false;albumState.isCanBrowse=true;albumState.browseQueue=0;return }if(albumState.browseQueue!=0){albumState.browseQueue++}albumState.isBrowsing=true;var nextImgPn=albumState.topImgPN+maxDispNum;if(nextImgPn>=listNum){slide.next(null,nextImgPn);albumState.topImgPN++}if(nextImgPn<listNum){slide.next(DataManager.getImgByPN(currPn,nextImgPn),nextImgPn);albumState.topImgPN++}return }function browsePreCallback(){albumState.isCanBrowse=true;albumState.isBrowsing=false;if(albumState.topImgPN==-AlbumConfig.preCacheMaxNum){if(slidePre.currClass&&slidePre.currClass!="preNone"){slidePre.className="preNone";slidePre.currClass="preNone"}}if(slideNext.currClass&&slideNext.currClass!="nextNormal"){slideNext.className="nextNormal";slideNext.currClass="nextNormal"}if(albumState.isBrowse||albumState.browseQueue!=0){browsePre()}}function browseNextCallback(){albumState.isCanBrowse=true;albumState.isBrowsing=false;if(albumState.topImgPN+displayNum+AlbumConfig.nextCacheMaxNum+AlbumConfig.preCacheMaxNum-1==listNum){if(slideNext.currClass&&slideNext.currClass!="nextNone"){slideNext.className="nextNone";slideNext.currClass="nextNone"}}if(slidePre.currClass&&slidePre.currClass!="preNormal"){slidePre.className="preNormal";slidePre.currClass="preNormal"}if(albumState.isBrowse||albumState.browseQueue!=0){browseNext()}}function scrollToPn(pn,imgsetPn){setImgSetInfo(pn);if(listNum<=displayNum){return }var temTopPN=imgsetPn-AlbumConfig.displayPosition-AlbumConfig.preCacheMaxNum+1;temTopPN=adapteTopPn(temTopPN);albumState.browseQueue=albumState.topImgPN-temTopPN;if(Math.abs(albumState.browseQueue)<displayNum){if(albumState.browseQueue>0){browsePre()}else{if(albumState.browseQueue<0){browseNext()}}}else{albumState.topImgPN=temTopPN;resetAlbumImg(temTopPN);albumState.browseQueue=0}resetBtnStyle()}function resetBtnStyle(){if(albumState.topImgPN<=-AlbumConfig.preCacheMaxNum){slidePre.className="preNone";slidePre.currClass="preNone"}else{slidePre.className="preNormal";slidePre.currClass="preNormal"}if(albumState.topImgPN>=listNum-displayNum-AlbumConfig.preCacheMaxNum){slideNext.className="nextNone";slideNext.currClass="nextNone"}else{slideNext.className="nextNormal";slideNext.currClass="nextNormal"}}function setArrow(){if(isdisplay){var currentPN=DataManager.getCurrentPN();if(currentPN==0){arrow.style.top="70px"}else{arrow.style.top="165px"}arrow.style.display="";arrow.style.left=albumleft+imgsetAlbumWidth+"px"}else{arrow.style.display="none"}}function toggle(pn){var currentISPN=DataManager.getCurrISPN();var num=DataManager.getISListNum(pn);setListNum(num);var lastDisplay=isdisplay;if(num>1){currPn=pn;imgSetObj.style.display="";albumState.topImgPN=currentISPN;isdisplay=true;var topISPN=currentISPN-AlbumConfig.displayPosition-AlbumConfig.preCacheMaxNum+1;topISPN=adapteTopPn(topISPN);albumState.topImgPN=topISPN;var n=displayNum+AlbumConfig.preCacheMaxNum+AlbumConfig.nextCacheMaxNum-maxDispNum;if(n<=0){resetAlbumImg(topISPN)}else{resetAlbumImg();topISPN=topISPN+maxDispNum;addAlbumImg(topISPN,n);maxDispNum=displayNum+AlbumConfig.preCacheMaxNum+AlbumConfig.nextCacheMaxNum}resetBtnStyle()}else{imgSetObj.style.display="none";albumState.topImgPN=-1;isdisplay=false}G("isSmallImgs").style.height=displayNum*(81+10)+10+"px";setImgSetInfo(pn);if(lastDisplay!=isdisplay){ImgMediator.resize()}setArrow()}function getImgeHtml(ImgObj){var imgHtml="";if(!!ImgObj){var offset=zoomImg(ImgObj.width,ImgObj.height,75);imgHtml='<table cellspacing="0"><tr><td align="center" valign="middle"><img name="'+ImgObj.pageNum+'" title="'+ImgObj.fromPageTitle.replace(/<.*?>/g,"").replace(/"/g,"&quot")+'" style="width:'+offset.width+"px;height:"+offset.height+'px" onload="this.style.display=	\'inline\'" onerror="BD.IMG.smallImgErr(this)" src="'+ImgObj.thumbURL+'"></tr></table>'}return imgHtml}function calcDisplayInfo(){return false}function reSizealbum(dispNum,left){displayNum=currDispNum=Math.floor(dispNum);listNum&&(displayNum=Math.min(displayNum,listNum));if(!isdisplay){lastCurrDispNum=displayNum;return }var listObj=G("isAlbum");listObj.style.left=left+"px";albumleft=left;var n=displayNum+AlbumConfig.preCacheMaxNum+AlbumConfig.nextCacheMaxNum-maxDispNum;var tempPn=albumState.topImgPN;var currentPN=DataManager.getCurrISPN();if(isPnDisplay(currentPN,tempPn,lastCurrDispNum)){tempPn=currentPN-AlbumConfig.displayPosition-AlbumConfig.preCacheMaxNum+1}tempPn=adapteTopPn(tempPn);if(tempPn==albumState.topImgPN){if(n>0){tempPn=tempPn+maxDispNum;addAlbumImg(tempPn,n);maxDispNum=displayNum+AlbumConfig.preCacheMaxNum+AlbumConfig.nextCacheMaxNum;displayNum=displayNum}}else{albumState.topImgPN=tempPn;resetAlbumImg(tempPn)}lastCurrDispNum=displayNum;G("isSmallImgs").style.height=displayNum*(81+10)+10+"px";resetBtnStyle();setArrow()}function resetAlbumImg(tempPn,num){tempPn=tempPn||albumState.topImgPN;num=num||maxDispNum;var currentPN=DataManager.getCurrentPN();var currISPN=DataManager.getCurrISPN();var initImgData,imglist;if(tempPn>0){initImgData=DataManager.getImgsByPn(currentPN,tempPn,num)}else{initImgData=DataManager.getImgsByPn(currentPN,0,num)}albumObj.style.display="none";imglist=albumObj.children;for(var i=0,j=0,n=imglist.length;i<n;i++,tempPn++){var tempDivObj=imglist[i];if(tempPn<0||tempPn>=listNum){tempDivObj.className="noImg";tempDivObj.innerHTML=""}else{var temImg=initImgData[j];j++;if(temImg.pageNum==currISPN){tempDivObj.className="select"}else{tempDivObj.className="noselect"}tempDivObj.innerHTML=getImgeHtml(temImg);tempDivObj.title=temImg.fromPageTitle.replace(/<.*?>/g,"")}tempDivObj.id="isPn_"+tempPn}albumObj.style.display=""}function isPnDisplay(pn,topPn,dispNum){return(pn-topPn+1>AlbumConfig.displayPosition+AlbumConfig.preCacheMaxNum&&topPn+Math.floor(dispNum)+AlbumConfig.nextCacheMaxNum>pn)}function addAlbumImg(tempPn,n){var initImgData;var currentPN=DataManager.getCurrentPN();var currISPN=DataManager.getCurrISPN();if(tempPn>0){initImgData=DataManager.getImgsByPn(currentPN,tempPn,n)}else{initImgData=DataManager.getImgsByPn(currentPN,0,n)}for(var i=0,j=0;i<n;i++,tempPn++){var tempDivObj=document.createElement("div");if(tempPn<0||tempPn>=listNum){tempDivObj.className="noImg"}else{var temImg=initImgData[j];j++;if(temImg.pageNum==currISPN){tempDivObj.className="select"}else{tempDivObj.className="noselect"}tempDivObj.innerHTML=getImgeHtml(temImg);tempDivObj.title=temImg.fromPageTitle.replace(/<.*?>/g,"")}tempDivObj.id="isPn_"+tempPn;albumObj.appendChild(tempDivObj)}}function adapteTopPn(tempPn){if(tempPn+displayNum+AlbumConfig.preCacheMaxNum>listNum){tempPn=listNum-displayNum-AlbumConfig.preCacheMaxNum}if(tempPn<-AlbumConfig.preCacheMaxNum){tempPn=-AlbumConfig.preCacheMaxNum}return tempPn}function __imgClick(e){var e=e||window.event;var obj=e.target||e.srcElement;if(obj!=albumObj){if(obj.nodeName!="IMG"){var chlidren=obj.getElementsByTagName("IMG");if(chlidren.length==0){return }obj=chlidren[0]}var imgSetPn=parseInt(obj.name);var currPn=DataManager.getCurrentPN();var currObj=DataManager.getImgByPN(currPn,imgSetPn);currObj.tp=null;currObj.nb=9;if(ImgSwitcher(currPn,imgSetPn)){BD.IMG.statistic.send(e,13,{nb:9})}}}return{browse:browse,stopBrowse:stopBrowse,scrollToPn:scrollToPn,reSizealbum:reSizealbum,toggle:toggle,setSwitcher:function(switcher){ImgSwitcher=switcher},init:init}})();var DetailImg=(function(){var detailSize;var ImgData;var srcPic;var imgContainer;var detailImg;var picWrap;var ImgSwitcher;var container;var picInfo;var switchType;var listNum;var imgElement;var imgFrom;var browsePreKey=38;var browseNextKey=40;var lastE;var timeOut=0;var lastImgObj;var kw;var loadHTML='<p style="height:31px;line-height:31px;"><img src="http://img.baidu.com/img/image/loading_detail.gif" style="vertical-align:middle;"> <span style="color:#999999;"> &nbsp; &nbsp;...</span></p>';function resizeDetailSize(size){size=size||sizeHandle.get();imgElement.zoom(size.picwrapWidth-5,size.picwrapHeight-5);G("rate").innerHTML=parseInt(imgElement.zoomRate*100)+"%";picWrap.style.width=size.picwrapWidth+"px";picWrap.style.height=size.picwrapHeight+"px";imgFrom.style.width=detailImg.style.width=size.detailImgWidth+"px";imgContainer.style.width=size.imgContainerWidth+"px";container.style.width=size.containerWidth+"px";detailSize=size;setfromURL()}function resetDetailSize(){if(!imgElement){return }var size=sizeHandle.get();imgElement.zoom(size.picwrapWidth-5,size.picwrapHeight-5);G("rate").innerHTML=parseInt(imgElement.zoomRate*100)+"%";picWrap.style.width=size.picwrapWidth+"px";picWrap.style.height=size.picwrapHeight+"px";imgFrom.style.width=detailImg.style.width=size.detailImgWidth+"px";imgContainer.style.width=size.imgContainerWidth+"px";container.style.width=size.containerWidth+"px";detailSize=size}function resetImgData(data){clearTimeout(timeOut);timeOut=0;lastImgObj=ImgData;ImgData=data;imgElement=ImgData.imgsrc;resetImgInfo();resetImgHTML();BD.IMG.curObj={thumbURL:data.thumbURL,objURL:data.objURL,fromURL:data.fromURL,width:data.width,height:data.height,type:data.type,filesize:data.filesize,bdSrcType:data.bdSrcType,di:data.di,fromPageTitle:data.fromPageTitle,token:data.token}}function resetImgInfo(){imgElement.zoom=zoom;imgElement.srcWidth=ImgData.width;imgElement.srcHeight=ImgData.height;imgElement.zoom(detailSize.picwrapWidth-5,detailSize.picwrapHeight-5);imgInfoOut();var errTest=ErrorImgTest();if(ImgData.loadState==1){errTest.ok(ImgData.imgLoadStart,ImgData.imgLoadEnd,ImgData)}else{if(ImgData.loadState==0){errTest.err(ImgData.imgLoadStart,ImgData.imgLoadEnd);resetErrorData()}else{ImgData.ok=errTest.ok;ImgData.err=errTest.err;ImgData.resetErrorData=resetErrorData}}}function resetImgHTML(){if(ImgData.loadState!=1&&ImgData.loadState!=0&&imgElement.width<imgElement.srcWidth){!timeOut&&(srcPic.innerHTML=loadHTML);timeOut=setTimeout(function(){resetImgHTML()},500);return }clearTimeout(timeOut);timeOut=0;if(ImgData.loadState!=0){if(!checkImg(imgElement,ImgData,true)){ImgData.loadTime=-2;ImgData.imgElementW=imgElement.width;ImgData.imgElementH=imgElement.height}else{ImgData.loadTime=1}srcPic.innerHTML="";srcPic.appendChild(ImgData.imgsrc)}else{resetErrorData()}}function resetErrorData(){srcPic.innerHTML='<img src="http://img.baidu.com/img/image/error.gif">';imgElement=srcPic.children[0];imgElement.zoom=zoom;imgElement.srcWidth=318;imgElement.srcHeight=73;imgElement.zoom(detailSize.picwrapWidth-5,detailSize.picwrapHeight-5)}function getOffset(obj){var top=0,left=0;top=obj.offsetTop;left=obj.offsetLeft;if(obj.offsetParent&&obj.offsetParent!=obj){var poffset=getOffset(obj.offsetParent);top+=poffset.top;left+=poffset.top}return{top:top,left:left}}function setPageOp(e){e=e||window.event;var p=getOffset(picWrap);var ey=e.clientY;var ty=p.top;var currentPN=DataManager.getCurrentPN();var imgsSetListNum=DataManager.getCurrISListNum();var currISPN=DataManager.getCurrISPN();if(listNum==1&&imgsSetListNum<=1){picWrap.className="firstPage";picWrap.title=""}else{if(ey-ty>parseInt(picWrap.style.height)/5){if(currentPN>=listNum-1&&currISPN>=imgsSetListNum-1){setLastClass()}else{setNextClass()}}else{if(currentPN<=0&&currISPN<=0){setFirstClass()}else{setPreClass()}}}lastE=e}function swithPage(e){if(picWrap.currClass=="prePage"){return function(){switchPre(e,1)}}else{if(picWrap.currClass=="nextPage"){return function(){switchNext(e,2)}}}}function switchPre(e,keyb){var e=e||window.event;var currentPN=DataManager.getCurrentPN();var currISPN=DataManager.getCurrISPN();if(currISPN>0){currISPN=currISPN-1}else{currentPN=currentPN-1}if(currentPN>=0){if(ImgSwitcher(currentPN,currISPN)){BD.IMG.statistic.send(e,12,{tp:3,keyb:keyb})}}}function switchNext(e,keyb){var e=e||window.event;var currentPN=DataManager.getCurrentPN();var currISPN=DataManager.getCurrISPN();var imgSetListNum=DataManager.getCurrISListNum();if(currISPN>=0&&currISPN<imgSetListNum-1){currISPN=currISPN+1}else{currISPN=-1;currentPN=currentPN+1}if(currentPN<listNum){if(ImgSwitcher(currentPN,currISPN)){BD.IMG.statistic.send(e,12,{tp:3,keyb:keyb})}}}function setPreClass(){if(picWrap.currClass=="prePage"){return }picWrap.className="prePage";picWrap.title="";picWrap.currClass="prePage"}function setFirstClass(){picWrap.className="firstPage";picWrap.title="";picWrap.currClass="firstPage"}function setNextClass(){if(picWrap.currClass=="nextPage"){return }picWrap.className="nextPage";picWrap.title="";picWrap.currClass="nextPage"}function setLastClass(){picWrap.className="lastPage";picWrap.title="";picWrap.currClass="lastPage"}function changePageByKey(e){var e=e||window.event;var keycode=e.keyCode||e.which;if(!e.ctrlKey&&keycode==browsePreKey){return function(){switchPre(e,3)}}if(!e.ctrlKey&&keycode==browseNextKey){return function(){switchNext(e,4)}}}function imgInfoOut(){G("size").innerHTML=ImgData.width+"x"+ImgData.height;G("rate").innerHTML=parseInt(imgElement.zoomRate*100)+"%";setfromURL();var currentPN=DataManager.getCurrentPN();var currISPN=DataManager.getCurrISPN();if(G("backToRsLnk")){setResultLnkUrl(currentPN)}setReportLnk(currentPN,currISPN)}function setfromURL(){var fromUrl=ImgData.fromURL.indexOf("tieba.baidu.com")>=0?ImgData.fromURL+"?fr=image_tieba":ImgData.fromURL;G("imgTitle").innerHTML='<a class="imgTitle" href="'+fromUrl+'" onclick="BD.IMG.statistic.send(event, 15);" target="_blank" >'+ImgData.bdFromPageTitlePrefix+ImgData.fromPageTitle+"</a>";var title=ImgData.bdSourceName||fromUrl;G("imgSite").innerHTML='&lt;<a href="'+fromUrl+'" onclick="BD.IMG.statistic.send(event, 15);" target="_blank" title="'+title+'">'+getUrl(ImgData.fromURL)+"</a>&gt;"}function getUrl(value){var _value=ImgData.bdSourceName;if(_value==""){reg=/[http,https]:\/\/([^\s]*)/;var _url=value.match(reg)[1];_value=truncateUrl(_url)}else{_value=truncateUrl(_value)}return _value}function truncateUrl(url){var width=detailSize.detailImgWidth-520;var sizeNum=Math.max(0,Math.floor(width/15));if(url.length<=sizeNum){url=url}else{if(url.length>sizeNum){url=url.slice(0,sizeNum)+"..."}else{url=url+"..."}}return url}function compareData(v1,v2,range){if(!range){range=0}if(Math.abs(v1-v2)>range){return false}else{return true}}function checkImg(img,imgData,noSize){if(!compareData(img.width,imgData.width,0)){return false}if(!compareData(img.height,imgData.height,0)){return false}return true}function ErrorImgTest(){var errorHost=BD.IMG.StatCof.host+"6.gif?u="+ImgData.objURL+"&f="+ImgData.fromURL;var errorURl=ImgData.objURL;var queryWord=BD.IMG.gconf.word;var sizeStr="z="+BD.IMG.gconf.z;var imgViewStart=(new Date()).getTime();ImgData.imgViewStart=imgViewStart;var tag=true;var tempImgData=ImgData;function ok(imgLoadStart,imgLoadEnd,imgData){if(tag&&imgData.imgsrc){var loadTime;var errstr="";if(imgData.loadTime){if(imgData.loadTime==-2){loadTime=-2;var w=(imgData.imgElementW||imgData.imgsrc.width);var h=(imgData.imgElementH||imgData.imgsrc.height);errstr="&w="+w+"&h="+h+"&size="+(imgData.imgsrc.fileSize?imgData.imgsrc.fileSize:"")}else{loadTime=imgLoadEnd-imgLoadStart}}else{if(checkImg(imgData.imgsrc,imgData)){loadTime=imgLoadEnd-imgLoadStart}else{loadTime=-2;errstr="&w="+imgData.imgsrc.width+"&h="+imgData.imgsrc.height+"&size="+(imgData.imgsrc.fileSize?imgData.imgsrc.fileSize:"")}}var viewTime=imgLoadEnd-imgViewStart;viewTime=viewTime<0?0:viewTime;var img=window["__log__"+(new Date()).getTime()]=new Image();img.src=errorHost+"&tm="+loadTime+"&q="+queryWord+"&"+sizeStr+"&viewtm="+viewTime+errstr+"&"+(new Date()).getTime();tag=false;tempImgData.loadState=1}}function err(imgLoadStart,imgLoadEnd){if(tag){tempImgData.loadState=0;if(errorURl==imgElement.src){clearTimeout(timeOut);timeOut=0;resetErrorData()}var loadTime=imgLoadEnd-imgLoadStart;var img=window["__log__"+(new Date()).getTime()]=new Image();img.src=errorHost+"&tm=-1&ltm="+loadTime+"&q="+queryWord+"&"+sizeStr+"&"+(new Date()).getTime();tag=false}}return{ok:ok,err:err}}function init(){srcPic=G("srcPic");imgContainer=G("imgContainer");picInfo=G("picInfo");detailImg=G("detailImg");picWrap=G("picWrap");container=G("container");imgFrom=G("imgFrom");kw=G("kw");listNum=DataManager.getListNum();detailSize=sizeHandle.get();var currPn=DataManager.getCurrentPN();picWrap.attachEvent("onmouseover",setPageOp);picWrap.attachEvent("onmousemove",setPageOp);var zoomSrc=G("zoomSrc");zoomSrc.attachEvent("onclick",function(event){window.open(ImgData.objURL,"_blank");BD.IMG.statistic.send(event,12,{tp:2})});backToRsPage();setResultLnkUrl(currPn);G("report").onclick=reportPic;window.attachEvent("onload",resetDetailSize);var timeOut=0,timeInteval=0;picWrap.attachEvent("onmouseup",function(e){kw.blur();e=e||window.event;if(e.button==2){return true}clearInterval(timeInteval);timeInteval=0;var fun=swithPage(e);fun&&fun()});var preventKeyDefault=function(e){var e=e||window.event;var keycode=e.keyCode||e.which;var target=e.target?e.target:e.srcElement;if(!e.ctrlKey&&(keycode==browsePreKey||keycode==browseNextKey)&&target.tagName.toUpperCase()!="INPUT"){if(e.preventDefault){e.preventDefault()}e.returnValue=false}};var isInput=function(e){e=e||window.event;var tag;if(e.srcElement){tag=e.srcElement}else{tag=e.target}if(tag.nodeName.toUpperCase()=="INPUT"){return true}else{return false}};var time=0;document.attachEvent("onkeydown",function(e){if(isInput(e)){return true}if(!timeInteval){var fun=changePageByKey(e);timeInteval=setInterval(function(){time++;if(fun instanceof Function){fun()}},800)}preventKeyDefault(e)});document.attachEvent("onkeypress",preventKeyDefault);document.attachEvent("onkeyup",function(e){if(isInput(e)){return true}if(time==0){var fun=changePageByKey(e);if(fun instanceof Function){fun()}}clearInterval(timeInteval);timeInteval=0;time=0;preventKeyDefault(e)});if(Browser.isGecko){picWrap.attachEvent("DOMMouseScroll",wheel)}else{picWrap.attachEvent("onmousewheel",wheel)}document.body.focus()}function wheel(e){var delta=0;e=e||window.event;if(e.wheelDelta){delta=e.wheelDelta/240}else{if(e.detail){delta=-e.detail/6}}if(delta&&delta>0){switchPre(e,6)}else{if(delta&&delta<0){switchNext(e,7)}}if(e.preventDefault){e.preventDefault()}e.returnValue=false}function backToRsPage(){G("backToRs").innerHTML='<span id="imgPnNum"></span>/<a id="backToRsLnk"></a>';var backToRsLnk=G("backToRsLnk");var qWord=BD.IMG.gconf.qword;var resTabs=BD.IMG.gconf.resTabs||[];var tab=parseInt(searchConf.tab);if(resTabs.length!=0&&!isNaN(tab)){qWord+=resTabs[tab]}backToRsLnk.href="";backToRsLnk.setAttribute("title","")}function setResultLnkUrl(num){num=num==0?0:num||searchConf.pn;var sme_count=searchConf.sme*1||0;var eachPageNum=BD.IMG.getMatrix()[0]*BD.IMG.getMatrix()[1];var ResultPn=Math.floor((num*1+sme_count)/eachPageNum)*eachPageNum-sme_count;ResultPn=ResultPn>=0?ResultPn+sme_count:0;var ResultQuery={};ResultQuery.tn="baiduimage";ResultQuery.ct="201326592";ResultQuery.cl=searchConf.cl;ResultQuery.lm=searchConf.lm;ResultQuery.fr=searchConf.fr;ResultQuery.pv=searchConf.pv||"";ResultQuery.ic=searchConf.ic||"";ResultQuery.z=searchConf.z;ResultQuery.se=searchConf.se||"";ResultQuery.word=searchConf.word;ResultQuery.s=searchConf.s||"";ResultQuery.sme=sme_count;ResultQuery.pn=0;ResultQuery.ln=searchConf.ln;ResultQuery.tab=searchConf.tab||"";ResultQuery.width=searchConf.width||"";ResultQuery.height=searchConf.height||"";ResultQuery.face=searchConf.face||"";ResultQuery.fb=searchConf.fb||"";ResultQuery.istype=searchConf.istype||"";var resultPn="";resultPn=("#pn="+ResultPn);var Rs_searchConf=BD.IMG.json2Query(ResultQuery);G("backToRsLnk").href="/i?"+Rs_searchConf+resultPn;G("imgPnNum").innerHTML=""+(num*1+1)+""}function setReportLnk(num,isNum){if(G("report").reportAble!="#pn"+num+"&"+isNum){G("report").style.cursor="pointer";G("report").style.textDecoration="underline"}}function reportPic(){if(this.reportAble==location.hash){return false}else{this.reportAble=location.hash;this.style.cursor="default";this.style.textDecoration="none";var host="http://tousu.baidu.com/image/add";var imgData=DataManager.getCurrentImgSetData();this.href=host+"?imagename="+BD.IMG.StatCof.q+"&imageurl="+imgData.objURL}}function getLastImgObj(){return lastImgObj}return{setImgSwitcher:function setImgSwitcher(Switcher){ImgSwitcher=Switcher},init:init,resizeDetailSize:resizeDetailSize,resetImgData:resetImgData,getLastImgObj:getLastImgObj,reportPic:reportPic}})();var ImgMediator=(function(){var lastSize;var timer;function switcher(num,imgSetNum){if(Album.isCanSwitch()==false){return false}var currPn=DataManager.getCurrentPN();var currISPn=DataManager.getCurrISPN();if(G("pn_"+currPn)){G("pn_"+currPn).className="noselect"}if(G("isPn_"+currISPn)){G("isPn_"+currISPn).className="noselect"}DataManager.resetCurrentPN(num,imgSetNum);currISPn=DataManager.getCurrISPN();var currObj=DataManager.getImgByPN(num,currISPn,true);if(currObj){setDetail(currObj)}return true}function setDetail(currObj){clearTimeout(timer);var currPn=DataManager.getCurrentPN();var currISPn=DataManager.getCurrISPN();if(G("pn_"+currPn)){G("pn_"+currPn).className="select"}if(G("isPn_"+currISPn)){G("isPn_"+currISPn).className="select"}timer=setTimeout(function(){window.location.hash="pn"+currPn+"&"+currISPn},1000);DetailImg.resetImgData(currObj);AlbumControl.scrollToPn(currPn,currISPn);scroll(0,0);BD.IMG.curObj={thumbURL:currObj.thumbURL,objURL:currObj.objURL,fromURL:currObj.fromURL,width:currObj.width,height:currObj.height,type:currObj.type,filesize:currObj.filesize,bdSrcType:currObj.bdSrcType,di:currObj.di,fromPageTitle:currObj.fromPageTitle,token:currObj.token};BD.IMG.widget.infoDiv.hideDiv();BD&&BD.SPACE&&BD.SPACE.zz&&BD.SPACE.zz.closeListPanel();return true}function init(){Album.setSwitcher(switcher);ImgsetAlbum.setSwitcher(switcher);DetailImg.setImgSwitcher(switcher);lastSize=sizeHandle.get();window.attachEvent("onresize",function(){var size=sizeHandle.get();if(Math.abs(size.detailImgWidth-lastSize.detailImgWidth)>10||Math.abs(size.detailImgHeight-lastSize.detailImgHeight)>10){resize(size)}});var currPn=DataManager.getCurrentPN();var currISPn=DataManager.getCurrISPN();switcher(currPn,currISPn);DetailImg.resizeDetailSize()}function resize(size){size=(size||sizeHandle.get());DetailImg.resizeDetailSize(size);AlbumControl.resizeAlbum(size);lastSize=size}return{switcher:switcher,resize:resize,setDetail:setDetail,init:init}})();window.ImgMediator=ImgMediator;BD.IMG.Login=(function(){var loginRendered=false;var registRendered=false;function buildLoginDiv(){return'<div id="image_pass_login_title"></div>					<div id="image_pass_login"></div>					<div id="image_pass_login_foot">						<div class="ti"></div>						<div class="co"></div>						<div class="bt"><input type="button" value="" onclick="BD.IMG.widget.floatDiv.showTab(\'1\');"></div>					</div>'}function buildRegistDiv(){return'<iframe id="img_reg_ifr" frameborder=0 scrolling=no style="width:100%;height:440px;" src="http://hi.baidu.com/reg/new?mode=iframe&u=http%3A%2F%2Fimage.baidu.com%2FspaceJump.html%3Ftype%3Dimgreg"></iframe>'}function checkLogin(type){if(BD.SPACE.uconf.userid==""){loginRendered=false;registRendered=false;var div=BD.IMG.widget.floatDiv.create("&nbsp;&nbsp;&nbsp;<strong></strong>",buildLoginDiv,{width:410,height:415,tabs:["",""]},buildRegistDiv,{width:680,height:510,tabs:["",""]});bdPass.ShellTemplate.render("login","image_pass_login",{tpl:"im",tokenUrl:"",jumpUrl:BD.SPACE.uconf.jumpUrl,labelName:{username:"",password:"&nbsp;&nbsp;",verifycode:""},onAfterRender:function(){loginRendered=true;var tmpbox=document.createElement("div");var tmpHtml='<iframe style="display:none;" frameborder=0 name="imglogin_iframe" id="imglogin_iframe"></iframe>';tmpbox.innerHTML=tmpHtml;G("image_pass_login").appendChild(tmpbox);G("PassFormlogin").setAttribute("target","imglogin_iframe")},onSuccess:function(){div.hideDiv();window.location.reload(true)},onFailure:function(){}});div.showDiv()}else{BD.IMG.widget.popDiv.hideDiv();var script=document.createElement("script");script.setAttribute("src",BD.SPACE.uconf.logicUrl+"?"+new Date()*Math.random());document.body.appendChild(script)}BD.SPACE.uconf.seleType=type}function _sendPic1(e){var e=e||window.event;BD.IMG.statistic.send(e,21)}function _sendPic2(e){var e=e||window.event;BD.IMG.statistic.send(e,22)}function init(){G("spacePic1").attachEvent("onclick",_sendPic1);G("spacePic2").attachEvent("onclick",_sendPic2);if(typeof BD.SPACE.uconf!="undefined"){BD.SPACE.uconf.fromURL=trim(BD.SPACE.uconf.fromURL);BD.SPACE.uconf.userid=trim(BD.SPACE.uconf.userid);BD.SPACE.uconf.spaceUrl=trim(BD.SPACE.uconf.spaceUrl)}if(BD.SPACE.uconf.userid!=""){var spaceAlbum=G("spaceAlbum");spaceAlbum.className="logined";G("spacePic1").attachEvent("onmouseover",function(){spaceAlbum.className="spacePic1_hover"});G("spacePic1").attachEvent("onmouseout",function(){spaceAlbum.className="logined"});G("spacePic2").attachEvent("onmouseover",function(){spaceAlbum.className="spacePic2_hover"});G("spacePic2").attachEvent("onmouseout",function(){spaceAlbum.className="logined"})}}function isRegistRendered(){return registRendered}function isLoginRendered(){return loginRendered}return{checkLogin:checkLogin,init:init,registRendered:isRegistRendered,loginRendered:isLoginRendered}})();SpaceAct={valid:false,isSubmit:false,context:null,buildHtml:function(root){var me=this;root.onSubmit=function(e){if(!e.valid){return false}else{if(!me.valid){e.valid=false;me.checkSpaceUrl(true);return false}}};root.onSuccess=function(){me.acticeSpace()};if(!window.G){window.G=function(id){return document.getElementById(id)}}window.setUserNameUsable=function(b){me.valid=b;if(b){me.showErrorTip("");if(me.isSubmit){G("PassFormreg").submit()}}else{me.isSubmit=false;me.showErrorTip(me.error.strError)}};window.onActiveSpaceSuccess=function(){(function(g){try{g.onActiveSpaceSuccess()}catch(e){}})(root)};var innerHTML='<div class="spacebox"><div><label>&nbsp;</label>http://hi.baidu.com/<input id="pass:space-url" class="spaceurl" type="text" onblur="SpaceAct.checkSpaceUrl()"/></div><div id="pass:space-tip" class="pass-note-failed"></div><div class="pass-desc"><b></b></div></div><iframe id="pass:space-act" style="display:none;"></iframe>';var topdom=G("PassFormreg").childNodes[0].childNodes[1];var newdom=document.createElement("span");newdom.innerHTML=innerHTML;topdom.insertBefore(newdom,topdom.childNodes[2])},acticeSpace:function(){var spaceIframe=G("pass:space-act");var username=G("PassFormreg").username.value;var spaceurl=G("pass:space-url").value;var hidomain="http://hi.baidu.com";var imdomain="http://image.baidu.com";spaceIframe.src=hidomain+"/sys/active?display=0&type=page&u="+encodeURIComponent(imdomain+"/spaceJump.html?type=imactivespace")+"&tpl=im&spaceurl="+encodeURIComponent(spaceurl)},error:{strBlank:"",strRange:"",strLen:"4-32()",strError:""},showErrorTip:function(s){var tip=G("pass:space-tip");tip.innerHTML=s;tip.style.display=(s.length==0)?"none":"block"},checkSpaceUrl:function(type){SpaceAct.isSubmit=type;var spaceurl=G("pass:space-url").value;var me=this,len=0;len=spaceurl.replace(/(\s+)/g,"").length;if(len==0){me.showErrorTip(me.error.strBlank);return false}len=spaceurl.replace(/[^\x00-\xff]/g,"mm").length;if(len<4||len>32){me.showErrorTip(me.error.strLen);return false}for(var i=0;i<spaceurl.length;i++){if(spaceurl.charCodeAt(i)<127&&!spaceurl.substr(i,1).match(/^\w+$/ig)){me.showErrorTip(me.error.strError);return false}}(function(p){var sc=document.createElement("SCRIPT");sc.type="text/javascript";sc.src="http://hi.baidu.com/sys/checkurl/item/"+p;document.getElementsByTagName("HEAD")[0].appendChild(sc)})(spaceurl);return false}};BD.IMG.widget={};BD.IMG.widget.floatDiv=(function(){var floatDivId="floatDiv";var divTitleId="floatDivTitle";var divTabbarId="floatDivTabbar";var divContentId1="floatDivContent1";var divContentId2="floatDivContent2";var divContent=[];var maskId="maskDiv";var shadowId="floatDivShadow";var closeIconId="floatDivClose";function showDiv(dom){if(typeof dom=="string"&&G(dom)!=null){G(dom).style.display=""}else{dom.style.display=""}}function hideDiv(dom){if(typeof dom=="string"&&G(dom)!=null){G(dom).style.display="none"}else{dom.style.display="none"}}function hideFloatDiv(){if(document.getElementById("floatDivContent2").style.display!="none"&&document.getElementById("img_reg_ifr")){window.location.reload()}hideDiv(floatDivId);hideDiv(shadowId);hideDiv(maskId);showTab(0)}function showFloatDiv(){showTab(0);showDiv(floatDivId);showDiv(shadowId);showDiv(maskId)}function infoCollector(options){var width=options.width||400;var height=options.height||400;var region=getBodySize();var left=(region.w-width)/2;if(left<0){left=0}var top=(region.h-height)/2;if(top<0){top=0}var scrollWidth=region.sw;var scrollHeight=region.sh;return{divW:width,divH:height,divL:left,divT:top,maskW:scrollWidth,maskH:scrollHeight}}var currentShowIndex=0;function showTab(index){if(BD.IMG.Login.loginRendered()==true&&index!=currentShowIndex){var len=realOptions.tabs.length;var temp=divContentId1;divContentId1=divContentId2;divContentId2=temp;var tempOptions=realOptions;realOptions=options2;options2=tempOptions;if(G(divContentId1).innerHTML==""&&divContent[index]){buildContent(divContent[index],divContentId1)}for(var i=0;i<len;i++){if(index==i){G("floatDivTab"+i).className="floatTab showTab"}else{G("floatDivTab"+i).className="floatTab hideTab"}}relocateDivs();G(divContentId1).style.display="";G(divContentId2).style.display="none";currentShowIndex=index}}var arrList=null;function buildTab(options){arrList=[];if(typeof options.tabs!="undefined"){var sdiv=[];var tabs=options.tabs;for(var i=0,len=tabs.length;i<len;i++){var id="floatDivTab"+i;sdiv.push("<div id='"+id+"' onclick='BD.IMG.widget.floatDiv.showTab(\""+i+"\");' class='floatTab "+(i==0?"showTab":"hideTab")+"'>");sdiv.push(tabs[i]);sdiv.push("</div>")}sdiv.push("<div style='clear:both;'></div>");var div=document.createElement("DIV");div.innerHTML=sdiv.join("");G(divTabbarId).innerHTML="";for(var i=0,len=div.childNodes.length;i<len;i++){var child=div.childNodes[0];G(divTabbarId).appendChild(child)}showDiv(divTabbarId)}else{hideDiv(divTabbarId)}}function buildContent(callback,id){var content=G(id);content.innerHTML="";var html=callback();if(typeof html=="string"||(typeof e=="object"&&e&&e.constructor==String)){content.innerHTML+=(html)}else{if(typeof html=="object"&&e&&e.tagName){content.appendChild(html)}}}function relocateDivs(){var locs=infoCollector(realOptions);G(floatDivId).style.width=locs.divW+"px";G(floatDivId).style.height=locs.divH+"px";G(floatDivId).style.left=locs.divL+"px";G(floatDivId).style.top=locs.divT+"px";G(shadowId).style.width=locs.divW+"px";G(shadowId).style.height=locs.divH+"px";G(shadowId).style.left=(locs.divL+5)+"px";G(shadowId).style.top=(locs.divT+5)+"px";G(maskId).style.width=document.body.scrollWidth+"px";G(maskId).style.height=locs.maskH+"px"}var hasBind=false;var realOptions=null;function createFloatDiv(title,contentCallback,options,contentCallback1,options1){realOptions=options;if(G(divTitleId).childNodes[1]!=null){G(divTitleId).removeChild(G(divTitleId).childNodes[1])}var titleDiv=document.createElement("DIV");titleDiv.innerHTML=title;G(divTitleId).appendChild(titleDiv);if(!hasBind){G(closeIconId).attachEvent("onclick",hideFloatDiv)}divContent[0]=contentCallback;divContent[1]=contentCallback1;buildContent(contentCallback,divContentId1);buildTab(options);relocateDivs();if(!hasBind){window.attachEvent("onresize",function(){relocateDivs()})}hasBind=true;options2=options1;showFloatDiv();return{floatDiv:G(floatDivId),showDiv:showFloatDiv,hideDiv:hideFloatDiv}}var options2=null;function appendContentCallback(callback,options){buildContent(callback,divContentId2);options2=options;hideDiv(divContentId2)}return{create:createFloatDiv,appendContentCallback:appendContentCallback,showTab:showTab}})();BD.IMG.widget.infoDiv=(function(){var infoDivId="infoDiv";var containerId="detailImg";var infoDiv=null;var option=null;var width=390;var height=35;var type="success";var hasBind=false;function create(message,options){option=options||{};infoDiv=G(infoDivId);width=option.width||width;height=option.height||height;type=option.type||type;if(infoDiv==null){var innerString="<div id='#{1}#' style='width:#{2}#px;height:#{3}#px;'><div id='infoDiv_close' onclick=\"BD.IMG.widget.infoDiv.hideDiv();\">X</div><div id='infoDiv_content' class='"+type+"'>#{4}#</div></div>";innerString=innerString.replaceS(infoDivId,width,height,message);var div=document.createElement("DIV");div.innerHTML=innerString;infoDiv=div.childNodes[0];G(containerId).appendChild(infoDiv)}else{infoDiv.style.width=width+"px";infoDiv.style.height=height+"px";G("infoDiv_content").className=type;G("infoDiv_content").innerHTML=message}relocateDiv();showDiv();if(!hasBind){window.attachEvent("onresize",function(){relocateDiv()})}hasBind=true;return infoDiv}function relocateDiv(){var containerWidth=G(containerId).offsetWidth;var containerHeight=G(containerId).offsetHeight;infoDiv.style.top=(containerHeight-height-50)+"px";infoDiv.style.left=parseInt((containerWidth-width)/2)+"px"}function hideDiv(){if(option&&option.onHide){option.onHide()}infoDiv&&(infoDiv.style.display="none")}function showDiv(){if(option&&option.onShow){option.onShow()}infoDiv&&(infoDiv.style.display="")}return{create:create,hideDiv:hideDiv,showDiv:showDiv}})();BD.IMG.widget.popDiv=(function(){var containerId=null;function create(container,text){if(BD.IMG.getCookie("imgPopHide")=="true"){return false}containerId=container;var cont=G(containerId);var top=-57;var left=-136;var popDiv=[];popDiv.push("<div id='popwidget' class='popwidget' style='top:"+top+"px;left:"+left+"px'><p class='tl'>&nbsp;</p>");popDiv.push("<div class='popwidget_text'>");popDiv.push(text);popDiv.push("</div>");popDiv.push("<p class='tr'>&nbsp;</p><p class='bc'>&nbsp;</p><div class='close_button' onclick='BD.IMG.widget.popDiv.hideDiv();'></div>");popDiv.push("</div>");var div=document.createElement("DIV");div.innerHTML=popDiv.join("");cont.appendChild(div.childNodes[0]);return true}function relocate(){if(G("popwidget")==null){return false}var cont=G(containerId);var top=-57;var left=-136;G("popwidget").style.top=top+"px";G("popwidget").style.left=left+"px"}function hideDiv(){var widget=G("popwidget");if(widget==null){return false}widget.style.display="none";BD.IMG.setCookie("imgPopHide","true")}return{create:create,hideDiv:hideDiv,relocate:relocate}})();function init(AlbumConfig){DataManager.init();DetailImg.init();Album.init(AlbumConfig);ImgsetAlbum.init(AlbumConfig);AlbumControl.init(AlbumConfig);ImgMediator.init();BD.IMG.Login.init();scroll(0,0)}return{init:init}})();